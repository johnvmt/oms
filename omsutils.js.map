{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/OmsUtils","node_modules/base64-js/lib/b64.js","node_modules/buffer/index.js","node_modules/buffer/node_modules/isarray/index.js","node_modules/fauxmongo/fauxmongo.js","node_modules/fauxmongo/lib/Aggregate.js","node_modules/fauxmongo/lib/AggregationOperators.js","node_modules/fauxmongo/lib/AggregationStages.js","node_modules/fauxmongo/lib/FauxmongoError.js","node_modules/fauxmongo/lib/GetBSONType.js","node_modules/fauxmongo/lib/GetTypeStr.js","node_modules/fauxmongo/lib/MatchLeaves.js","node_modules/fauxmongo/lib/MatchQuery.js","node_modules/fauxmongo/lib/Merge.js","node_modules/fauxmongo/lib/MoreDollars.js","node_modules/fauxmongo/lib/Project.js","node_modules/fauxmongo/lib/QueryOperators.js","node_modules/fauxmongo/lib/ResolveDollar.js","node_modules/fauxmongo/lib/Set.js","node_modules/fauxmongo/lib/Sorting.js","node_modules/fauxmongo/lib/Update.js","node_modules/fauxmongo/lib/UpdateOperators.js","node_modules/ieee754/index.js","node_modules/process/browser.js","node_modules/util/node_modules/inherits/inherits_browser.js","node_modules/util/support/isBufferBrowser.js","node_modules/util/util.js"],"names":["lookup","exports","decode","elt","code","charCodeAt","PLUS","PLUS_URL_SAFE","SLASH","SLASH_URL_SAFE","NUMBER","UPPER","LOWER","b64ToByteArray","b64","push","v","arr","L","i","j","l","tmp","placeHolders","length","Error","len","charAt","Arr","uint8ToBase64","uint8","encode","num","tripletToBase64","temp","extraBytes","output","Uint8Array","Array","toByteArray","fromByteArray","this","base64js","typedArraySupport","Bar","foo","constructor","subarray","byteLength","e","kMaxLength","Buffer","TYPED_ARRAY_SUPPORT","arg","parent","undefined","fromNumber","fromString","arguments","fromObject","that","allocate","checked","string","encoding","write","object","isBuffer","fromBuffer","isArray","fromArray","TypeError","ArrayBuffer","buffer","fromTypedArray","fromArrayBuffer","fromArrayLike","fromJsonObject","copy","array","_augment","type","data","__proto__","prototype","_isBuffer","fromPool","poolSize","rootParent","RangeError","toString","SlowBuffer","subject","buf","loweredCase","utf8ToBytes","base64ToBytes","toLowerCase","slowToString","start","end","Infinity","hexSlice","utf8Slice","asciiSlice","binarySlice","base64Slice","utf16leSlice","hexWrite","offset","Number","remaining","strLen","parsed","parseInt","substr","isNaN","utf8Write","blitBuffer","asciiWrite","asciiToBytes","binaryWrite","base64Write","ucs2Write","utf16leToBytes","base64","slice","Math","min","res","firstByte","codePoint","bytesPerSequence","secondByte","thirdByte","fourthByte","tempCodePoint","decodeCodePointsArray","codePoints","MAX_ARGUMENTS_LENGTH","String","fromCharCode","apply","ret","out","toHex","bytes","checkOffset","ext","checkInt","value","max","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","ieee754","writeDouble","base64clean","str","stringtrim","replace","INVALID_BASE64_RE","trim","n","units","leadSurrogate","byteArray","c","hi","lo","src","dst","require","INSPECT_MAX_BYTES","global","b","compare","a","x","y","isEncoding","concat","list","pos","item","equals","inspect","match","join","indexOf","val","byteOffset","arrayIndexOf","foundIndex","call","get","console","log","readUInt8","set","writeUInt8","isFinite","swap","toJSON","_arr","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt16LE","readUInt16BE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","read","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","floor","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","target","targetStart","_set","fill","toArrayBuffer","BP","toLocaleString","module","getBSONType","MatchQuery","Update","Merge","Project","Aggregate","FauxmongoError","matchQuery","update","merge","project","aggregate","resolveDollar","docs","pipeline","keepStages","stages","operator","stage","Object","keys","err","expression","hasOwnProperty","StageOperators","evaluate","getTypeStr","evaluateExpression","context","varname","pointer","CURRENT","frags","split","frag","key","newDoc","$literal","backup","spec","$let","tempVar","vars","retval","in","$map","as","input","results","AggregationOperators","matchLeaves","Sorting","leafSorter","getLeafsort","Set","$and","$or","$not","Boolean","$allElementsTrue","$anyElementTrue","$setDifference","able","baker","difference","export","$setEquals","sets","first","$setIntersection","walker","intersect","$setIsSubset","contains","$setUnion","union","$cmp","$eq","$gt","$gte","$lt","$lte","$ne","$add","vals","datestamp","tms","getTime","setTime","total","$divide","$mod","$multiply","accumulator","$subtract","$concat","$strcasecmp","toUpperCase","$substr","$toLower","$toUpper","$meta","$size","$dayOfMonth","Date","getDate","$dayOfWeek","getDay","$dayOfYear","getFullYear","diff","$hour","getHours","$millisecond","getMilliseconds","$minute","getMinutes","$month","getMonth","$second","getSeconds","$week","days","setDate","firstSunday","setMonth","ceil","$year","$cond","ifx","thenx","elsex","if","then","else","$ifNull","AggregationAccumulators","$addToSet","add","$avg","count","$first","$last","$max","highest","$min","lowest","$push","$sum","accumulators","clone","thing","newThing","subthing","cloneArr","thingArr","AggregationStages","$geoNear","$group","strings","nums","others","otherDocs","doc","id","_id","idType","done","jobs","jobDocLists","stringIDs","numIDs","jobID","jobDocs","accumulant","subexpression","sxkeys","$limit","$match","$project","currentDoc","dotsBanned","layersBanned","lastStep","isExpression","writeHead","notFound","k","specKeys","subdoc","layerProjection","projectLevel","layer","projection","didSomething","specKey","levelProjection","$redact","DESCEND","KEEP","PRUNE","action","redacted","redactLevel","readHead","newVal","$skip","$sort","sort","getDocsort","$unwind","path","newDocs","innerPointer","m","message","info","util","inherits","obj","simpleNums","round","BSON_TYPES","tstr","typeGetter","aType","bType","query","root","rootlen","subquery","subtype","matchSubquery","pointerType","ok","earlyMatch","index","upperSubpath","specialSubquery","fullfilled","$exists","moreDollars","op","operators","ops","document","simpleMerge","source","childType","tval","tvalType","simpleArrayMerge","mergeLevel","subsource","subtarget","basePath","keypath","mergeArrayLevel","newArr","directive","$elemMatch","$slice","dropped","splice","dollarPath","dollarPosition","level","multiproject","mainTarget","remainingPath","found","pathStep","finalStep","previousStep","previousPPointer","outputDoc","ppointer","pathFrags","broken","dollarFrags","docfrag","JSON","stringify","leafTypeStr","newCloneArr","LOOKUP_BSON_TYPE","1","2","3","4","5","6","8","9","10","11","13","16","18","fieldOps","$in","isString","$nin","$regex","$type","arrOps","$all","pathstr","pslen","dollar","didDocumentQuery","qpath","dummyQuery","values","other","oi","newSet","otherStrings","otherNums","map","sspec","leafsort","SORT_PRIORITY","aKeys","bKeys","comp","aHighest","bHighest","aLowest","bLowest","specPaths","specFullpaths","aPointer","bPointer","direction","ARR_SORT_PRIORITY","change","oldPath","$rename","notOK","newPath","$set","$unset","dollarTarget","dollarTargetStr","job","stubborn","STUBBORN_OPS","writing","newDollar","newDollarStr","MOD_OPS","$each","$position","$inc","$mul","$currentDate","$pushAll","changeType","$bit","bitop","delta","$isolated","candidate","position","each","$pop","pop","shift","$pull","$pullAll","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","d","s","NaN","rt","abs","LN2","defaultSetTimout","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","setTimeout","runClearTimeout","marker","cachedClearTimeout","clearTimeout","cleanUpNextTick","draining","currentQueue","queue","queueIndex","drainQueue","timeout","run","Item","noop","process","nextTick","args","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","name","cwd","chdir","dir","umask","create","ctor","superCtor","super_","enumerable","writable","configurable","TempCtor","opts","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","isUndefined","customInspect","stylizeWithColor","formatValue","styleType","style","styles","arrayToHash","hash","forEach","idx","recurseTimes","isFunction","primitive","formatPrimitive","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","RegExp","isDate","base","braces","toUTCString","formatArray","formatProperty","reduceToSingleString","simple","isNumber","isNull","desc","getOwnPropertyDescriptor","line","numLinesEst","reduce","prev","cur","ar","isNullOrUndefined","isSymbol","re","isObject","objectToString","isPrimitive","o","pad","timestamp","time","months","prop","formatRegExp","format","f","objects","_","deprecate","fn","msg","deprecated","warned","throwDeprecation","traceDeprecation","trace","error","noDeprecation","debugs","debugEnviron","debuglog","NODE_DEBUG","test","pid","bold","italic","underline","inverse","white","grey","black","blue","cyan","green","magenta","red","yellow","special","number","boolean","null","date","regexp","origin"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var FauxMongo=require(\"fauxmongo\"),OmsUtils={};OmsUtils.docMatch=function(o,t){return FauxMongo.matchQuery(o,t)},OmsUtils.operationFunctionArguments=function(o){switch(o.operation){case\"insert\":return[o.doc,o.options];case\"update\":return[{_id:o.unmodifiedDoc._id},o.updateOperation,o.options];case\"remove\":return[{_id:o.doc._id},o.options];case\"subscribe\":return[o.status,\"object\"==typeof o.options&&null!=o.options?o.options:{}];default:throw new Error(\"undefined_operation_type\")}},OmsUtils.operationDoc=function(o){return{date:new Date,operation:o}},OmsUtils.operationDocMin=function(o){return{_id:o._id,operation:OmsUtils.operationObjectMin(o.operation)}},OmsUtils.operationObjectMin=function(o){switch(o.operation){case\"remove\":return{operation:o.operation,doc:{_id:o.doc._id},options:o.options};case\"update\":return{operation:o.operation,unmodifiedDoc:{_id:o.unmodifiedDoc._id},updateOperation:o.updateOperation,options:o.options};case\"insert\":case\"subscribe\":default:return o}},OmsUtils.operationObject=function(o,t){switch(o){case\"insert\":case\"remove\":return{operation:o,doc:t[0],options:\"object\"!=typeof t[1]&&null==t[1]?{}:t[1]};case\"update\":return{operation:o,unmodifiedDoc:t[0],modifiedDoc:t[1],updateOperation:t[2],options:\"object\"!=typeof t[3]||null==t[3]?{}:t[3]};case\"subscribe\":return{operation:o,status:t[0],options:\"object\"!=typeof t[1]||null==t[1]?{}:t[1]};default:throw new Error(\"undefined_operation_type\")}},module.exports=OmsUtils;","var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n;(function (exports) {\n\t'use strict';\n\n  var Arr = (typeof Uint8Array !== 'undefined')\n    ? Uint8Array\n    : Array\n\n\tvar PLUS   = '+'.charCodeAt(0)\n\tvar SLASH  = '/'.charCodeAt(0)\n\tvar NUMBER = '0'.charCodeAt(0)\n\tvar LOWER  = 'a'.charCodeAt(0)\n\tvar UPPER  = 'A'.charCodeAt(0)\n\tvar PLUS_URL_SAFE = '-'.charCodeAt(0)\n\tvar SLASH_URL_SAFE = '_'.charCodeAt(0)\n\n\tfunction decode (elt) {\n\t\tvar code = elt.charCodeAt(0)\n\t\tif (code === PLUS ||\n\t\t    code === PLUS_URL_SAFE)\n\t\t\treturn 62 // '+'\n\t\tif (code === SLASH ||\n\t\t    code === SLASH_URL_SAFE)\n\t\t\treturn 63 // '/'\n\t\tif (code < NUMBER)\n\t\t\treturn -1 //no match\n\t\tif (code < NUMBER + 10)\n\t\t\treturn code - NUMBER + 26 + 26\n\t\tif (code < UPPER + 26)\n\t\t\treturn code - UPPER\n\t\tif (code < LOWER + 26)\n\t\t\treturn code - LOWER + 26\n\t}\n\n\tfunction b64ToByteArray (b64) {\n\t\tvar i, j, l, tmp, placeHolders, arr\n\n\t\tif (b64.length % 4 > 0) {\n\t\t\tthrow new Error('Invalid string. Length must be a multiple of 4')\n\t\t}\n\n\t\t// the number of equal signs (place holders)\n\t\t// if there are two placeholders, than the two characters before it\n\t\t// represent one byte\n\t\t// if there is only one, then the three characters before it represent 2 bytes\n\t\t// this is just a cheap hack to not do indexOf twice\n\t\tvar len = b64.length\n\t\tplaceHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0\n\n\t\t// base64 is 4/3 + up to two characters of the original data\n\t\tarr = new Arr(b64.length * 3 / 4 - placeHolders)\n\n\t\t// if there are placeholders, only get up to the last complete 4 chars\n\t\tl = placeHolders > 0 ? b64.length - 4 : b64.length\n\n\t\tvar L = 0\n\n\t\tfunction push (v) {\n\t\t\tarr[L++] = v\n\t\t}\n\n\t\tfor (i = 0, j = 0; i < l; i += 4, j += 3) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))\n\t\t\tpush((tmp & 0xFF0000) >> 16)\n\t\t\tpush((tmp & 0xFF00) >> 8)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\tif (placeHolders === 2) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)\n\t\t\tpush(tmp & 0xFF)\n\t\t} else if (placeHolders === 1) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)\n\t\t\tpush((tmp >> 8) & 0xFF)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\treturn arr\n\t}\n\n\tfunction uint8ToBase64 (uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length\n\n\t\tfunction encode (num) {\n\t\t\treturn lookup.charAt(num)\n\t\t}\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)\n\t\t}\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n\t\t\toutput += tripletToBase64(temp)\n\t\t}\n\n\t\t// pad the end with zeros, but make sure to not forget the extra bytes\n\t\tswitch (extraBytes) {\n\t\t\tcase 1:\n\t\t\t\ttemp = uint8[uint8.length - 1]\n\t\t\t\toutput += encode(temp >> 2)\n\t\t\t\toutput += encode((temp << 4) & 0x3F)\n\t\t\t\toutput += '=='\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\ttemp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])\n\t\t\t\toutput += encode(temp >> 10)\n\t\t\t\toutput += encode((temp >> 4) & 0x3F)\n\t\t\t\toutput += encode((temp << 2) & 0x3F)\n\t\t\t\toutput += '='\n\t\t\t\tbreak\n\t\t}\n\n\t\treturn output\n\t}\n\n\texports.toByteArray = b64ToByteArray\n\texports.fromByteArray = uint8ToBase64\n}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\nBuffer.poolSize = 8192 // not used by this implementation\n\nvar rootParent = {}\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Safari 5-7 lacks support for changing the `Object.prototype.constructor` property\n *     on objects.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\nfunction typedArraySupport () {\n  function Bar () {}\n  try {\n    var arr = new Uint8Array(1)\n    arr.foo = function () { return 42 }\n    arr.constructor = Bar\n    return arr.foo() === 42 && // typed array instances can be augmented\n        arr.constructor === Bar && // constructor can be set\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\n/**\n * Class: Buffer\n * =============\n *\n * The Buffer constructor returns instances of `Uint8Array` that are augmented\n * with function properties for all the node `Buffer` API functions. We use\n * `Uint8Array` so that square bracket notation works as expected -- it returns\n * a single octet.\n *\n * By augmenting the instances, we can avoid modifying the `Uint8Array`\n * prototype.\n */\nfunction Buffer (arg) {\n  if (!(this instanceof Buffer)) {\n    // Avoid going through an ArgumentsAdaptorTrampoline in the common case.\n    if (arguments.length > 1) return new Buffer(arg, arguments[1])\n    return new Buffer(arg)\n  }\n\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    this.length = 0\n    this.parent = undefined\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    return fromNumber(this, arg)\n  }\n\n  // Slightly less common case.\n  if (typeof arg === 'string') {\n    return fromString(this, arg, arguments.length > 1 ? arguments[1] : 'utf8')\n  }\n\n  // Unusual.\n  return fromObject(this, arg)\n}\n\nfunction fromNumber (that, length) {\n  that = allocate(that, length < 0 ? 0 : checked(length) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < length; i++) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') encoding = 'utf8'\n\n  // Assumption: byteLength() return value is always < kMaxLength.\n  var length = byteLength(string, encoding) | 0\n  that = allocate(that, length)\n\n  that.write(string, encoding)\n  return that\n}\n\nfunction fromObject (that, object) {\n  if (Buffer.isBuffer(object)) return fromBuffer(that, object)\n\n  if (isArray(object)) return fromArray(that, object)\n\n  if (object == null) {\n    throw new TypeError('must start with number, buffer, array or string')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined') {\n    if (object.buffer instanceof ArrayBuffer) {\n      return fromTypedArray(that, object)\n    }\n    if (object instanceof ArrayBuffer) {\n      return fromArrayBuffer(that, object)\n    }\n  }\n\n  if (object.length) return fromArrayLike(that, object)\n\n  return fromJsonObject(that, object)\n}\n\nfunction fromBuffer (that, buffer) {\n  var length = checked(buffer.length) | 0\n  that = allocate(that, length)\n  buffer.copy(that, 0, 0, length)\n  return that\n}\n\nfunction fromArray (that, array) {\n  var length = checked(array.length) | 0\n  that = allocate(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\n// Duplicate of fromArray() to keep fromArray() monomorphic.\nfunction fromTypedArray (that, array) {\n  var length = checked(array.length) | 0\n  that = allocate(that, length)\n  // Truncating the elements is probably not what people expect from typed\n  // arrays with BYTES_PER_ELEMENT > 1 but it's compatible with the behavior\n  // of the old Buffer constructor.\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array) {\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    array.byteLength\n    that = Buffer._augment(new Uint8Array(array))\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromTypedArray(that, new Uint8Array(array))\n  }\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = checked(array.length) | 0\n  that = allocate(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\n// Deserialize { type: 'Buffer', data: [1,2,3,...] } into a Buffer object.\n// Returns a zero-length buffer for inputs that don't conform to the spec.\nfunction fromJsonObject (that, object) {\n  var array\n  var length = 0\n\n  if (object.type === 'Buffer' && isArray(object.data)) {\n    array = object.data\n    length = checked(array.length) | 0\n  }\n  that = allocate(that, length)\n\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n} else {\n  // pre-set for values that may exist in the future\n  Buffer.prototype.length = undefined\n  Buffer.prototype.parent = undefined\n}\n\nfunction allocate (that, length) {\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = Buffer._augment(new Uint8Array(length))\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that.length = length\n    that._isBuffer = true\n  }\n\n  var fromPool = length !== 0 && length <= Buffer.poolSize >>> 1\n  if (fromPool) that.parent = rootParent\n\n  return that\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (subject, encoding) {\n  if (!(this instanceof SlowBuffer)) return new SlowBuffer(subject, encoding)\n\n  var buf = new Buffer(subject, encoding)\n  delete buf.parent\n  return buf\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  var i = 0\n  var len = Math.min(x, y)\n  while (i < len) {\n    if (a[i] !== b[i]) break\n\n    ++i\n  }\n\n  if (i !== len) {\n    x = a[i]\n    y = b[i]\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'binary':\n    case 'base64':\n    case 'raw':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) throw new TypeError('list argument must be an Array of Buffers.')\n\n  if (list.length === 0) {\n    return new Buffer(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; i++) {\n      length += list[i].length\n    }\n  }\n\n  var buf = new Buffer(length)\n  var pos = 0\n  for (i = 0; i < list.length; i++) {\n    var item = list[i]\n    item.copy(buf, pos)\n    pos += item.length\n  }\n  return buf\n}\n\nfunction byteLength (string, encoding) {\n  if (typeof string !== 'string') string = '' + string\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'binary':\n      // Deprecated\n      case 'raw':\n      case 'raws':\n        return len\n      case 'utf8':\n      case 'utf-8':\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  start = start | 0\n  end = end === undefined || end === Infinity ? this.length : end | 0\n\n  if (!encoding) encoding = 'utf8'\n  if (start < 0) start = 0\n  if (end > this.length) end = this.length\n  if (end <= start) return ''\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'binary':\n        return binarySlice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return 0\n  return Buffer.compare(this, b)\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset) {\n  if (byteOffset > 0x7fffffff) byteOffset = 0x7fffffff\n  else if (byteOffset < -0x80000000) byteOffset = -0x80000000\n  byteOffset >>= 0\n\n  if (this.length === 0) return -1\n  if (byteOffset >= this.length) return -1\n\n  // Negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = Math.max(this.length + byteOffset, 0)\n\n  if (typeof val === 'string') {\n    if (val.length === 0) return -1 // special case: looking for empty string always fails\n    return String.prototype.indexOf.call(this, val, byteOffset)\n  }\n  if (Buffer.isBuffer(val)) {\n    return arrayIndexOf(this, val, byteOffset)\n  }\n  if (typeof val === 'number') {\n    if (Buffer.TYPED_ARRAY_SUPPORT && Uint8Array.prototype.indexOf === 'function') {\n      return Uint8Array.prototype.indexOf.call(this, val, byteOffset)\n    }\n    return arrayIndexOf(this, [ val ], byteOffset)\n  }\n\n  function arrayIndexOf (arr, val, byteOffset) {\n    var foundIndex = -1\n    for (var i = 0; byteOffset + i < arr.length; i++) {\n      if (arr[byteOffset + i] === val[foundIndex === -1 ? 0 : i - foundIndex]) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === val.length) return byteOffset + foundIndex\n      } else {\n        foundIndex = -1\n      }\n    }\n    return -1\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\n// `get` is deprecated\nBuffer.prototype.get = function get (offset) {\n  console.log('.get() is deprecated. Access using array indexes instead.')\n  return this.readUInt8(offset)\n}\n\n// `set` is deprecated\nBuffer.prototype.set = function set (v, offset) {\n  console.log('.set() is deprecated. Access using array indexes instead.')\n  return this.writeUInt8(v, offset)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new Error('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; i++) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) throw new Error('Invalid hex string')\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction binaryWrite (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    var swap = encoding\n    encoding = offset\n    offset = length | 0\n    length = swap\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'binary':\n        return binaryWrite(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction binarySlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; i++) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = Buffer._augment(this.subarray(start, end))\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; i++) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  if (newBuf.length) newBuf.parent = this.parent || this\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('buffer must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; i++) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; i++) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = value < 0 ? 1 : 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = value < 0 ? 1 : 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (value > max || value < min) throw new RangeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('index out of range')\n  if (offset < 0) throw new RangeError('index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; i--) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; i++) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    target._set(this.subarray(start, start + len), targetStart)\n  }\n\n  return len\n}\n\n// fill(value, start=0, end=buffer.length)\nBuffer.prototype.fill = function fill (value, start, end) {\n  if (!value) value = 0\n  if (!start) start = 0\n  if (!end) end = this.length\n\n  if (end < start) throw new RangeError('end < start')\n\n  // Fill 0 bytes; we're done\n  if (end === start) return\n  if (this.length === 0) return\n\n  if (start < 0 || start >= this.length) throw new RangeError('start out of bounds')\n  if (end < 0 || end > this.length) throw new RangeError('end out of bounds')\n\n  var i\n  if (typeof value === 'number') {\n    for (i = start; i < end; i++) {\n      this[i] = value\n    }\n  } else {\n    var bytes = utf8ToBytes(value.toString())\n    var len = bytes.length\n    for (i = start; i < end; i++) {\n      this[i] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n/**\n * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.\n * Added in Node 0.12. Only available in browsers that support ArrayBuffer.\n */\nBuffer.prototype.toArrayBuffer = function toArrayBuffer () {\n  if (typeof Uint8Array !== 'undefined') {\n    if (Buffer.TYPED_ARRAY_SUPPORT) {\n      return (new Buffer(this)).buffer\n    } else {\n      var buf = new Uint8Array(this.length)\n      for (var i = 0, len = buf.length; i < len; i += 1) {\n        buf[i] = this[i]\n      }\n      return buf.buffer\n    }\n  } else {\n    throw new TypeError('Buffer.toArrayBuffer not supported in this browser')\n  }\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar BP = Buffer.prototype\n\n/**\n * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods\n */\nBuffer._augment = function _augment (arr) {\n  arr.constructor = Buffer\n  arr._isBuffer = true\n\n  // save reference to original Uint8Array set method before overwriting\n  arr._set = arr.set\n\n  // deprecated\n  arr.get = BP.get\n  arr.set = BP.set\n\n  arr.write = BP.write\n  arr.toString = BP.toString\n  arr.toLocaleString = BP.toString\n  arr.toJSON = BP.toJSON\n  arr.equals = BP.equals\n  arr.compare = BP.compare\n  arr.indexOf = BP.indexOf\n  arr.copy = BP.copy\n  arr.slice = BP.slice\n  arr.readUIntLE = BP.readUIntLE\n  arr.readUIntBE = BP.readUIntBE\n  arr.readUInt8 = BP.readUInt8\n  arr.readUInt16LE = BP.readUInt16LE\n  arr.readUInt16BE = BP.readUInt16BE\n  arr.readUInt32LE = BP.readUInt32LE\n  arr.readUInt32BE = BP.readUInt32BE\n  arr.readIntLE = BP.readIntLE\n  arr.readIntBE = BP.readIntBE\n  arr.readInt8 = BP.readInt8\n  arr.readInt16LE = BP.readInt16LE\n  arr.readInt16BE = BP.readInt16BE\n  arr.readInt32LE = BP.readInt32LE\n  arr.readInt32BE = BP.readInt32BE\n  arr.readFloatLE = BP.readFloatLE\n  arr.readFloatBE = BP.readFloatBE\n  arr.readDoubleLE = BP.readDoubleLE\n  arr.readDoubleBE = BP.readDoubleBE\n  arr.writeUInt8 = BP.writeUInt8\n  arr.writeUIntLE = BP.writeUIntLE\n  arr.writeUIntBE = BP.writeUIntBE\n  arr.writeUInt16LE = BP.writeUInt16LE\n  arr.writeUInt16BE = BP.writeUInt16BE\n  arr.writeUInt32LE = BP.writeUInt32LE\n  arr.writeUInt32BE = BP.writeUInt32BE\n  arr.writeIntLE = BP.writeIntLE\n  arr.writeIntBE = BP.writeIntBE\n  arr.writeInt8 = BP.writeInt8\n  arr.writeInt16LE = BP.writeInt16LE\n  arr.writeInt16BE = BP.writeInt16BE\n  arr.writeInt32LE = BP.writeInt32LE\n  arr.writeInt32BE = BP.writeInt32BE\n  arr.writeFloatLE = BP.writeFloatLE\n  arr.writeFloatBE = BP.writeFloatBE\n  arr.writeDoubleLE = BP.writeDoubleLE\n  arr.writeDoubleBE = BP.writeDoubleBE\n  arr.fill = BP.fill\n  arr.inspect = BP.inspect\n  arr.toArrayBuffer = BP.toArrayBuffer\n\n  return arr\n}\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; i++) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; i++) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","\r\n/**     @module fauxmongo\r\n    Match MongoDB queries, apply updates and test aggregation pipelines on local documents.\r\n@spare README\r\n    This is the rendered output of the `fauxmongo` source documentation.\r\n    *View the [source](https://github.com/shenanigans/node-fauxmongo) on GitHub!*\r\n    @load\r\n        ./README.md\r\n*/\r\n\r\nvar getBSONType     = require ('./lib/GetBSONType');\r\nvar MatchQuery      = require ('./lib/MatchQuery');\r\nvar Update          = require ('./lib/Update');\r\nvar Merge           = require ('./lib/Merge');\r\nvar Project         = require ('./lib/Project');\r\nvar Aggregate       = require ('./lib/Aggregate');\r\nvar FauxmongoError  = require ('./lib/FauxmongoError');\r\n\r\nmodule.exports.matchQuery = MatchQuery;\r\nmodule.exports.update = Update;\r\nmodule.exports.merge = Merge;\r\nmodule.exports.project = Project;\r\nmodule.exports.aggregate = Aggregate;\r\nmodule.exports.FauxmongoError = FauxmongoError;\r\nmodule.exports.getBSONType = getBSONType;\r\nmodule.exports.resolveDollar = Update.resolveDollar;\r\n","\r\nvar StageOperators = require ('./AggregationStages');\r\nvar evaluate = require ('./AggregationOperators').evaluate;\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar FauxmongoError = require ('./FauxmongoError');\r\n\r\n/**     @property/Function fauxmongo.aggregate\r\n    @root\r\n    @api\r\n    Locally apply a MongoDB aggregation pipeline. Does not affect the input documents. Optionally\r\n    returns the results of each individual stage as well as the final result.\r\n@argument/Array[Object] docs\r\n    An Array of documents to process.\r\n@argument/Array[Object] pipeline\r\n    An Array of stage operator specifications used to select/modify the source documents.\r\n@argument/Boolean keepStages\r\n    @optional\r\n    If true, the return value is an Array containing each Array of results produced by each stage.\r\n    Otherwise the return value is the final result Array.\r\n@returns/Array|Array[Array]\r\n    Either the final result set or an Array containing the result set of each stage.\r\n*/\r\n\r\nfunction aggregate (docs, pipeline, keepStages) {\r\n    var stages;\r\n    if (keepStages)\r\n        stages = [];\r\n\r\n    for (var i in pipeline) {\r\n        var stage = pipeline[i];\r\n        var operator;\r\n        try {\r\n            operator = Object.keys (stage)[0];\r\n        } catch (err) {\r\n            // ignore empty stages\r\n            continue;\r\n        }\r\n        if (operator == '$out') {\r\n            if (i != pipeline.length - 1)\r\n                throw new FauxmongoError (\r\n                    'INVALID',\r\n                    'found an $out stage that was not the final stage'\r\n                );\r\n            break;\r\n        }\r\n\r\n        var expression = stage[operator];\r\n\r\n        if (!Object.hasOwnProperty.call (StageOperators, operator))\r\n            throw new FauxmongoError ('INVALID', 'unknown operator', { operator:operator });\r\n        docs = StageOperators[operator] (docs, expression);\r\n        if (keepStages)\r\n            stages.push (docs);\r\n    }\r\n\r\n    if (keepStages)\r\n        return stages;\r\n    return docs;\r\n}\r\n\r\nmodule.exports = aggregate;\r\naggregate.evaluateExpression = evaluate;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar getBSONType = require ('./GetBSONType');\r\nvar matchLeaves = require ('./MatchQuery').matchLeaves;\r\nvar Sorting = require ('./Sorting');\r\nvar leafSorter = Sorting.getLeafsort (1);\r\nvar Set = require ('./Set');\r\nvar FauxmongoError = require ('./FauxmongoError');\r\n\r\nfunction evaluate (expression, context) {\r\n    var type = getTypeStr (expression);\r\n    if (type == 'string') {\r\n        if (expression[0] == '$')\r\n            if (expression[1] == '$') {\r\n                // variable\r\n                var varname = expression.slice (2);\r\n                if (Object.hasOwnProperty.call (context, varname))\r\n                    return context[varname];\r\n                throw new FauxmongoError ('INVALID', 'variable '+expression+' not found');\r\n            } else {\r\n                // path\r\n                var pointer = context.CURRENT;\r\n                var frags = expression.slice(1).split ('.');\r\n                for (var i in frags) {\r\n                    var frag = frags[i];\r\n                    if (!Object.hasOwnProperty.call (pointer, frag))\r\n                        return undefined;\r\n                    pointer = pointer[frag];\r\n                }\r\n                return pointer;\r\n            }\r\n        return expression;\r\n    }\r\n\r\n    if (type == 'object') {\r\n        var key = Object.keys (expression)[0];\r\n        if (key[0] != '$') {\r\n            var newDoc = {};\r\n            for (var key in expression)\r\n                newDoc[key] = evaluate (expression[key], context);\r\n            return newDoc;\r\n        }\r\n\r\n        if (key == '$literal')\r\n            return expression.$literal;\r\n\r\n        if (key == '$let') {\r\n            var backup = {};\r\n            var spec = expression.$let;\r\n\r\n            // prime context\r\n            for (var tempVar in spec.vars) {\r\n                if (Object.hasOwnProperty.call (context, tempVar))\r\n                    backup[tempVar] = context[tempVar];\r\n                context[tempVar] = evaluate (spec.vars[tempVar], context);\r\n            }\r\n\r\n            // evaluate with primed context\r\n            var retval = evaluate (spec.in, context);\r\n\r\n            // restore context\r\n            for (var tempVar in spec.vars) {\r\n                if (Object.hasOwnProperty.call (backup, tempVar))\r\n                    context[tempVar] = backup[tempVar];\r\n                else\r\n                    delete context[tempVar];\r\n            }\r\n\r\n            return retval;\r\n        }\r\n\r\n        if (key == '$map') {\r\n            var spec = expression.$map;\r\n            var backup = Object.hasOwnProperty.call (context, spec.as) ?\r\n                context[spec.as]\r\n              : undefined\r\n              ;\r\n\r\n            var docs = evaluate (spec.input, context);\r\n            if (!(docs instanceof Array))\r\n                throw new Error ('$map requires an Array input');\r\n\r\n            var results = [];\r\n            for (var i in docs) {\r\n                context[spec.as] = docs[i];\r\n                results.push (evaluate (spec.in, context));\r\n            }\r\n\r\n            if (backup !== undefined)\r\n                context[spec.as] = backup;\r\n            else\r\n                delete context[spec.as];\r\n            return results;\r\n        }\r\n\r\n        if (!Object.hasOwnProperty.call (AggregationOperators, key))\r\n            throw new Error ('unknown aggregation operator '+key);\r\n        return AggregationOperators[key] (expression[key], context);\r\n    }\r\n\r\n    return expression;\r\n}\r\n\r\n\r\nvar AggregationOperators = {\r\n    '$and':             function (expression, context) {\r\n        for (var i in expression)\r\n            if (!evaluate (expression[i], context))\r\n                return false;\r\n        return true;\r\n    },\r\n    '$or':              function (expression, context) {\r\n        for (var i in expression)\r\n            if (!evaluate (expression[i], context))\r\n                return true;\r\n        return false;\r\n    },\r\n    '$not':             function (expression, context) {\r\n        return ! Boolean (evaluate (expression[0], context));\r\n    },\r\n    '$allElementsTrue': function (expression, context) {\r\n        expression = expression[0];\r\n        var set = evaluate (expression, context);\r\n        if (!(set instanceof Array))\r\n            throw new Error ('$allElementsTrue requires an Array');\r\n        for (var i in set)\r\n            if (!set[i])\r\n                return false;\r\n        return true;\r\n    },\r\n    '$anyElementTrue':  function (expression, context) {\r\n        expression = expression[0];\r\n        var set = evaluate (expression, context);\r\n        if (!(set instanceof Array))\r\n            throw new Error ('$anyElementTrue requires an Array');\r\n        for (var i in set)\r\n            if (set[i])\r\n                return true;\r\n        return false;\r\n    },\r\n    '$setDifference':   function (expression, context) {\r\n        var able = new Set (evaluate (expression[0], context));\r\n        var baker = new Set (evaluate (expression[1], context));\r\n        able.difference (baker);\r\n        return able.export();\r\n    },\r\n    '$setEquals':       function (expression, context) {\r\n        var sets = [];\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            if (!(val instanceof Array))\r\n                throw new Error ('$setEquals only accepts Arrays');\r\n            sets.push (new Set (val));\r\n        }\r\n\r\n        if (sets.length < 2)\r\n            throw new Error ('$setEquals requires at least 2 sets');\r\n\r\n        var first = sets[1];\r\n        for (var i=1,j=sets.length; i<j; i++)\r\n            if (!first.equals (sets[i]))\r\n                return false;\r\n\r\n        return true;\r\n    },\r\n    '$setIntersection': function (expression, context) {\r\n        var sets = [];\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            if (!(val instanceof Array))\r\n                throw new Error ('$setIntersection only accepts Arrays');\r\n            sets.push (new Set (val));\r\n        }\r\n\r\n        if (sets.length < 2)\r\n            throw new Error ('$setIntersection requires at least 2 sets');\r\n\r\n        var walker = sets[0];\r\n        for (var i=1,j=sets.length; i<j; i++)\r\n            walker = walker.intersect (sets[i]);\r\n\r\n        return walker.export();\r\n    },\r\n    '$setIsSubset':     function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (!(able instanceof Array) || !(baker instanceof Array))\r\n            throw new FauxmongoError ('FORMAT', '$setIsSubset only accepts Arrays');\r\n        able = new Set (able);\r\n        baker = new Set (baker);\r\n        return baker.contains (able);\r\n    },\r\n    '$setUnion':        function (expression, context) {\r\n        var sets = [];\r\n        for (var i in expression)\r\n            sets.push (new Set (evaluate (expression[i], context)));\r\n\r\n        if (sets.length < 2)\r\n            throw new Error ('$setIntersection requires at least 2 sets');\r\n\r\n        var first = sets[0];\r\n        for (var i=1,j=sets.length; i<j; i++)\r\n            first.union (sets[i]);\r\n\r\n        return first.export();\r\n    },\r\n    '$cmp':             function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker);\r\n    },\r\n    '$eq':              function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return matchLeaves (able, baker);\r\n    },\r\n    '$gt':              function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker) > 0 ? true : false;\r\n    },\r\n    '$gte':             function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker) >= 0 ? true : false;\r\n    },\r\n    '$lt':              function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker) < 0 ? true : false;\r\n    },\r\n    '$lte':             function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker) <= 0 ? true : false;\r\n    },\r\n    '$ne':              function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return !matchLeaves (able, baker);\r\n    },\r\n    '$add':             function (expression, context) {\r\n        var vals = [];\r\n        var datestamp = false;\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            var type = typeof val;\r\n            if (type == 'date')\r\n                if (datestamp)\r\n                    throw new Error ('$add accepts at most 1 Date');\r\n                else datestamp = val;\r\n            else if (type != 'number')\r\n                throw new Error ('$add only accepts Numbers and Dates');\r\n            else\r\n                vals.push (val);\r\n        }\r\n\r\n        if (datestamp) {\r\n            var tms = datestamp.getTime();\r\n            for (var i in vals)\r\n                tms += vals[i];\r\n            datestamp.setTime (tms);\r\n            return datestamp;\r\n        }\r\n\r\n        var total = 0;\r\n        for (var i in vals)\r\n            total += vals[i];\r\n        return total;\r\n    },\r\n    '$divide':          function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (typeof able != 'number' || typeof baker != 'number')\r\n            throw new Error ('$divide only accepts Numbers');\r\n\r\n        return able / baker;\r\n    },\r\n    '$mod':             function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (typeof able != 'number' || typeof baker != 'number')\r\n            throw new Error ('$divide only accepts Numbers');\r\n\r\n        return able % baker;\r\n    },\r\n    '$multiply':        function (expression, context) {\r\n        var vals = [];\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            if (typeof val != 'number')\r\n                throw new Error ('$multiply only accepts Numbers');\r\n            vals.push (val);\r\n        }\r\n\r\n        var accumulator = 1;\r\n        for (var i in vals)\r\n            accumulator *= vals[i];\r\n        return accumulator;\r\n    },\r\n    '$subtract':        function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (typeof able != 'number' || typeof baker != 'number')\r\n            throw new Error ('$divide only accepts Numbers');\r\n\r\n        return able - baker;\r\n    },\r\n    '$concat':          function (expression, context) {\r\n        var vals = [];\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            if (typeof val != 'string')\r\n                if (val === null || val === undefined)\r\n                    return null;\r\n                else\r\n                    throw new Error ('$multiply only accepts Numbers');\r\n            vals.push (val);\r\n        }\r\n\r\n        if (vals.length < 2)\r\n            throw new Error ('$concat requires at least 2 arguments');\r\n\r\n        return String.prototype.concat.apply ('', vals);\r\n    },\r\n    '$strcasecmp':      function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (typeof able != 'string' || typeof baker != 'string')\r\n            throw new Error ('$strcasecmp only accepts Strings');\r\n\r\n        able = able.toUpperCase();\r\n        baker = baker.toUpperCase();\r\n        if (able == baker)\r\n            return 0;\r\n        if (able < baker)\r\n            return -1;\r\n        return 1;\r\n    },\r\n    '$substr':          function (expression, context) {\r\n        var str = evaluate (expression[0], context);\r\n        var start = evaluate (expression[1], context);\r\n        var length = evaluate (expression[2], context);\r\n\r\n        if (typeof str != 'string' || typeof start != 'number' || typeof length != 'number')\r\n            throw new Error ('invalid arguments to $substr');\r\n\r\n        if (start < 0)\r\n            return '';\r\n        if (length < 0)\r\n            return str.slice (start);\r\n        return str.slice (start, start + length);\r\n    },\r\n    '$toLower':         function (expression, context) {\r\n        var str = evaluate (expression, context);\r\n        if (str === null)\r\n            return '';\r\n        if (typeof str != 'string')\r\n            throw new Error ('$toLower only accepts Strings');\r\n        return str.toLowerCase();\r\n    },\r\n    '$toUpper':         function (expression, context) {\r\n        var str = evaluate (expression, context);\r\n        if (str === null)\r\n            return '';\r\n        if (typeof str != 'string')\r\n            throw new Error ('$toUpper only accepts Strings');\r\n        return str.toUpperCase();\r\n    },\r\n    '$meta':            function (expression, context) {\r\n        throw new Error ('$meta not supported');\r\n    },\r\n    '$size':            function (expression, context) {\r\n        var arr = evaluate (expression, context);\r\n        if (!(arr instanceof Array))\r\n            throw new Error ('$size only accepts Arrays');\r\n        return arr.length;\r\n    },\r\n    '$dayOfMonth':      function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$dayOfMonth only accepts Dates');\r\n        return expression.getDate();\r\n    },\r\n    '$dayOfWeek':       function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$dayOfWeek only accepts Dates');\r\n        return (expression.getDay() % 7) + 1;\r\n    },\r\n    '$dayOfYear':       function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$dayOfYear only accepts Dates');\r\n\r\n        // all the oldest javascript apis are puketastic\r\n        var start = new Date(expression.getFullYear(), 0, 0);\r\n        var diff = expression - start;\r\n        return Math.floor (diff / ( 1000 * 60 * 60 * 24 ));\r\n    },\r\n    '$hour':            function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$hour only accepts Dates');\r\n        return expression.getHours();\r\n    },\r\n    '$millisecond':     function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$millisecond only accepts Dates');\r\n        return expression.getMilliseconds();\r\n    },\r\n    '$minute':          function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$minute only accepts Dates');\r\n        return expression.getMinutes();\r\n    },\r\n    '$month':           function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$month only accepts Dates');\r\n        return expression.getMonth() + 1;\r\n    },\r\n    '$second':          function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$second only accepts Dates');\r\n        return expression.getSeconds();\r\n    },\r\n    '$week':            function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$week only accepts Dates');\r\n\r\n        // create a target date set to Sunday of the same week as the expression\r\n        var target = new Date (expression.getTime());\r\n        var days = (expression.getDay() + 6) % 7;\r\n        target.setDate (target.getDate() - days - 1);\r\n        // store the time of the week's Sunday\r\n        var firstSunday = target.getTime();\r\n\r\n        // switch to January 1st and advance to Sunday\r\n        target.setMonth (0, 1);\r\n        days = target.getDay();\r\n        if (days != 7)\r\n            target.setMonth (0, 7 - days);\r\n\r\n        return 1 + Math.ceil ((target.getTime() - firstSunday) / (1000 * 60 * 60 * 24 * 7));\r\n    },\r\n    '$year':            function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$year only accepts Dates');\r\n        return expression.getFullYear();\r\n    },\r\n    '$cond':            function (expression, context) {\r\n        var ifx, thenx, elsex;\r\n        if (expression instanceof Array) {\r\n            ifx = expression[0];\r\n            thenx = expression[1];\r\n            elsex = expression[2];\r\n        } else {\r\n            if (typeof expression != 'object')\r\n                throw new Error ('$cond requires either an Object or Array of arguments');\r\n            ifx = expression.if;\r\n            thenx = expression.then;\r\n            elsex = expression.else;\r\n        }\r\n\r\n        if (evaluate (ifx, context) === true)\r\n            return evaluate (thenx, context);\r\n        return evaluate (elsex, context);\r\n    },\r\n    '$ifNull':          function (expression, context) {\r\n        var val = evaluate (expression[0], context);\r\n        if (val === null)\r\n            return evaluate (expression[1], context);\r\n        return val;\r\n    }\r\n};\r\n\r\n\r\nvar AggregationAccumulators = {\r\n    '$addToSet':    function (expression, docs) {\r\n        var set = new Set();\r\n        for (var i in docs)\r\n            set.add (evaluate (expression, { CURRENT:docs[i] }));\r\n        return set.export();\r\n    },\r\n    '$avg':         function (expression, docs) {\r\n        var count = 0;\r\n        var total = 0;\r\n        for (var i in docs) {\r\n            var val = evaluate (expression, { CURRENT:docs[i] });\r\n            if (typeof val != 'number')\r\n                throw new FauxmongoError ('FORMAT', '$sum only accepts numbers');\r\n            total += val;\r\n            count++;\r\n        }\r\n        return total / count;\r\n    },\r\n    '$first':       function (expression, docs) {\r\n        return evaluate (expression, { CURRENT:docs[0] });\r\n    },\r\n    '$last':        function (expression, docs) {\r\n        return evaluate (expression, { CURRENT:docs[docs.length-1] });\r\n    },\r\n    '$max':         function (expression, docs) {\r\n        var highest = evaluate (expression, { CURRENT:docs[0] });\r\n        for (var i=1,j=docs.length; i<j; i++) {\r\n            var val = evaluate (expression, { CURRENT:docs[i] });\r\n            if (leafSorter (val, highest) > 0)\r\n                highest = val;\r\n        }\r\n        return highest;\r\n    },\r\n    '$min':         function (expression, docs) {\r\n        var lowest = evaluate (expression, { CURRENT:docs[0] });\r\n        for (var i=1,j=docs.length; i<j; i++) {\r\n            var val = evaluate (expression, { CURRENT:docs[i] });\r\n            if (leafSorter (val, lowest) < 0)\r\n                lowest = val;\r\n        }\r\n        return lowest;\r\n    },\r\n    '$push':        function (expression, docs) {\r\n        var output = [];\r\n        for (var i in docs)\r\n            output.push (evaluate (expression, { CURRENT:docs[i] }));\r\n        return output;\r\n    },\r\n    '$sum':         function (expression, docs) {\r\n        var total = 0;\r\n        for (var i in docs) {\r\n            var val = evaluate (expression, { CURRENT:docs[i] });\r\n            if (typeof val != 'number')\r\n                throw new FauxmongoError ('FORMAT', '$sum only accepts numbers');\r\n            total += val;\r\n        }\r\n        return total;\r\n    }\r\n};\r\n\r\n\r\nmodule.exports.evaluate = evaluate;\r\nmodule.exports.accumulators = AggregationAccumulators;\r\n","\r\nvar AggregationOperators    = require ('./AggregationOperators');\r\nvar matchQuery              = require ('./MatchQuery');\r\nvar project                 = require ('./Project');\r\nvar Sorting                 = require ('./Sorting');\r\nvar getTypeStr              = require ('./GetTypeStr');\r\nvar FauxmongoError          = require ('./FauxmongoError');\r\n\r\nfunction clone (thing) {\r\n    var newThing = {};\r\n    for (var key in thing) {\r\n        var subthing = thing[key];\r\n        if (typeof subthing == 'object')\r\n            if (subthing instanceof Array)\r\n                newThing[key] = cloneArr (subthing);\r\n            else\r\n                newThing[key] = clone (subthing);\r\n        else\r\n            newThing[key] = thing[key];\r\n    }\r\n    return newThing;\r\n}\r\n\r\nfunction cloneArr (thingArr) {\r\n    var newThing = [];\r\n    for (var i in thingArr) {\r\n        var subthing = thingArr[i];\r\n        if (typeof subthing == 'object')\r\n            if (thingArr instanceof Array)\r\n                newThing[i] = clone (subthing);\r\n            else\r\n                newThing[i] = cloneArr (subthing);\r\n        else\r\n            newThing[i] = thingArr[i];\r\n    }\r\n    return newThing;\r\n}\r\n\r\n\r\nvar AggregationStages = {\r\n    '$geoNear':     function (docs, expression) {\r\n        throw new FauxmongoError ('SUPPORT', '$geoNear is not supported');\r\n    },\r\n    '$group':       function (docs, expression) {\r\n        var strings = {};\r\n        var nums = {};\r\n        var others = [];\r\n        var otherDocs = [];\r\n\r\n        // establish the groups\r\n        for (var i in docs) {\r\n            var doc = docs[i];\r\n            var context = { CURRENT:doc };\r\n            var id = AggregationOperators.evaluate (expression._id, context);\r\n            var idType = getTypeStr (id);\r\n\r\n            if (idType == 'string')\r\n                if (Object.hasOwnProperty.call (strings, id))\r\n                    strings[id].push (doc);\r\n                else\r\n                    strings[id] = [ doc ];\r\n            else if (idType == 'number')\r\n                if (Object.hasOwnProperty.call (nums, id))\r\n                    nums[id].push (doc);\r\n                else\r\n                    nums[id] = [ doc ];\r\n            else {\r\n                var done = false;\r\n                for (var i in others)\r\n                    if (matchQuery.matchLeaves (id, others[i])) {\r\n                        done = true;\r\n                        otherDocs[i].push (doc);\r\n                        break;\r\n                    }\r\n                if (!done) {\r\n                    others.push (id);\r\n                    otherDocs.push ([ doc ]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // assemble the groups into a single manageable task\r\n        var jobs = others;\r\n        var jobDocLists = otherDocs;\r\n        var stringIDs = Object.keys (strings);\r\n        var numIDs = Object.keys (nums);\r\n        jobs.push.apply (jobs, stringIDs);\r\n        jobs.push.apply (jobs, numIDs);\r\n        for (var i in stringIDs)\r\n            jobDocLists.push (strings[stringIDs[i]]);\r\n        for (var i in numIDs)\r\n            jobDocLists.push (nums[numIDs[i]]);\r\n\r\n        // accumulate each group\r\n        var output = [];\r\n        for (var i in jobs) {\r\n            var jobID = jobs[i];\r\n            var jobDocs = jobDocLists[i];\r\n            var accumulant = { _id:jobID };\r\n\r\n            for (var key in expression) {\r\n                if (key == '_id')\r\n                    continue;\r\n\r\n                var subexpression = expression[key];\r\n                var sxkeys = Object.keys (subexpression);\r\n                if (\r\n                    !sxkeys.length\r\n                 || !Object.hasOwnProperty.call (AggregationOperators.accumulators, sxkeys[0])\r\n                )\r\n                    throw new FauxmongoError (\r\n                        'INVALID',\r\n                        '$group found an invalid aggregation spec'\r\n                    );\r\n\r\n                var currentVal = Object.hasOwnProperty.call (accumulant, key) ?\r\n                    accumulant[key]\r\n                  : undefined\r\n                  ;\r\n\r\n                accumulant[key] = AggregationOperators.accumulators[sxkeys[0]] (\r\n                    subexpression[sxkeys[0]],\r\n                    jobDocs\r\n                );\r\n            }\r\n\r\n            output.push (accumulant);\r\n        }\r\n\r\n        return output;\r\n    },\r\n    '$limit':       function (docs, expression) {\r\n        return docs.slice (0, expression);\r\n    },\r\n    '$match':       function (docs, expression) {\r\n        var output = [];\r\n        for (var i=0,j=docs.length; i<j; i++)\r\n            if (matchQuery (docs[i], expression))\r\n                output.push (docs[i]);\r\n        return output;\r\n    },\r\n    '$project':     function (docs, expression) {\r\n        var output = [];\r\n        for (var i in docs) {\r\n            var currentDoc = docs[i];\r\n            var context = { CURRENT:currentDoc };\r\n            var dotsBanned = false;\r\n            var layersBanned = false;\r\n            var newDoc = {};\r\n            for (var key in expression) {\r\n                if (key == '_id') {\r\n                    var val = expression[key]\r\n                    if (val === 0 || val === false)\r\n                        continue;\r\n                }\r\n\r\n                var spec = expression[key];\r\n                if (typeof spec == 'object' && !(spec instanceof Array)) {\r\n                    var specKeys = Object.keys (spec);\r\n                    if (specKeys[0] && specKeys[0][0] == '$') {\r\n                        newDoc[key] = evaluate (spec, context);\r\n                        continue;\r\n                    }\r\n\r\n                    // layer!\r\n                    if (layersBanned)\r\n                        throw new FauxmongoError (\r\n                            'INVALID',\r\n                            '$project cannot combine dot-notation and layered spec'\r\n                        );\r\n                    dotsBanned = true;\r\n\r\n                    var subdoc = Object.hasOwnProperty.call (currentDoc, key) ?\r\n                        currentDoc[key]\r\n                      : undefined\r\n                      ;\r\n                    var layerProjection = (function projectLevel (doc, layer) {\r\n                        var projection = {};\r\n                        var didSomething = false;\r\n                        for (var key in layer) {\r\n                            var spec = layer[key];\r\n                            if (typeof spec == 'object' && !(spec instanceof Array)) {\r\n                                var specKeys = Object.keys (spec);\r\n                                if (specKeys[0] && specKeys[0][0] == '$') {\r\n                                    projection[key] = AggregationOperators.evaluate (\r\n                                        spec,\r\n                                        context\r\n                                    );\r\n                                    didSomething = true;\r\n                                } else\r\n                                    for (var j in specKeys) {\r\n                                        var specKey = specKeys[j];\r\n                                        var subdoc =\r\n                                                doc\r\n                                             && Object.hasOwnProperty.call (doc, specKey) ?\r\n                                            doc[specKey]\r\n                                          : undefined\r\n                                          ;\r\n                                        var levelProjection = projectLevel (\r\n                                            subdoc,\r\n                                            spec[specKey],\r\n                                            projection[specKey] = {}\r\n                                        );\r\n                                        if (levelProjection !== undefined) {\r\n                                            didSomething = true;\r\n                                            projection[specKey] = levelProjection;\r\n                                        }\r\n                                    }\r\n                                continue;\r\n                            }\r\n\r\n                            if (spec === 1 || spec === true) {\r\n                                if (doc && Object.hasOwnProperty.call (doc, key)) {\r\n                                    projection[key] = doc[key];\r\n                                    didSomething = true;\r\n                                }\r\n                            } else {\r\n                                projection[key] = AggregationOperators.evaluate (\r\n                                    spec,\r\n                                    context\r\n                                );\r\n                                didSomething = true;\r\n                            }\r\n                        }\r\n\r\n                        if (didSomething)\r\n                            return projection;\r\n                    }) (subdoc, spec);\r\n                    if (layerProjection !== undefined)\r\n                        newDoc[key] = layerProjection;\r\n                    continue;\r\n                }\r\n\r\n                var isExpression = spec === 1 || spec === true ? false : true;\r\n\r\n                var pointer = docs[i];\r\n                var writeHead = newDoc;\r\n                var lastStep;\r\n                var frags = key.split ('.');\r\n                if (frags.length > 1 && dotsBanned)\r\n                    throw new FauxmongoError (\r\n                        '$project cannot combine dot-notation and layered spec',\r\n                        'INVALID'\r\n                    );\r\n                layersBanned = true;\r\n                var notFound = false;\r\n                for (var k=0,l=frags.length-1; k<l; k++) {\r\n                    var frag = frags[k];\r\n                    if (!Object.hasOwnProperty.call (pointer, frag)) {\r\n                        if (!isExpression) {\r\n                            notFound = true;\r\n                            break;\r\n                        }\r\n                    } else\r\n                        pointer = pointer[frag];\r\n                    if (!Object.hasOwnProperty.call (writeHead, frag))\r\n                        if (pointer[frag] instanceof Array)\r\n                            writeHead[frag] = [];\r\n                        else\r\n                            writeHead[frag] = {};\r\n                    writeHead = writeHead[frag];\r\n                }\r\n                if (notFound) // skip this key in the projection\r\n                    continue;\r\n                lastStep = frags[frags.length-1];\r\n\r\n                if (isExpression)\r\n                    writeHead[lastStep] = AggregationOperators.evaluate (spec, context);\r\n                else if (Object.hasOwnProperty.call (pointer, lastStep))\r\n                    writeHead[lastStep] = pointer[lastStep];\r\n            }\r\n\r\n            output.push (newDoc);\r\n        }\r\n\r\n        return output;\r\n    },\r\n    '$redact':      function (docs, expression) {\r\n        var output = [];\r\n\r\n        for (var i in docs) {\r\n            var doc = docs[i];\r\n            var context = { CURRENT:doc, DESCEND:{}, KEEP:{}, PRUNE:{} };\r\n            var action = AggregationOperators.evaluate (expression, context);\r\n            if (action === context.PRUNE)\r\n                continue;\r\n            if (action === context.KEEP) {\r\n                output.push (doc);\r\n                continue;\r\n            }\r\n            if (action !== context.DESCEND)\r\n                throw new FauxmongoError (\r\n                    'INVALID',\r\n                    '$redact expects one of $$PRUNE, $$KEEP, $$DESCEND'\r\n                );\r\n\r\n            // DESCEND\r\n            newDoc = {};\r\n            for (var key in doc) {\r\n                var val = doc[key];\r\n                if (typeof val != 'object') {\r\n                    newDoc[key] = doc[key];\r\n                    continue;\r\n                }\r\n\r\n                var redacted = (function redactLevel (readHead) {\r\n                    if (readHead instanceof Array) {\r\n                        var newDoc = [];\r\n                        for (var i in readHead) {\r\n                            var val = readHead[i];\r\n                            if (typeof val != 'object')\r\n                                newDoc.push (val);\r\n                            else {\r\n                                var newVal = redactLevel (val);\r\n                                if (newVal !== undefined)\r\n                                    newDoc.push (newVal);\r\n                            }\r\n                        }\r\n                        if (newDoc.length)\r\n                            return newDoc;\r\n                        return;\r\n                    }\r\n\r\n                    context.CURRENT = readHead;\r\n                    var action = AggregationOperators.evaluate (expression, context);\r\n                    if (action === context.PRUNE)\r\n                        return;\r\n                    if (action === context.KEEP)\r\n                        return readHead;\r\n                    if (action !== context.DESCEND)\r\n                        throw new FauxmongoError (\r\n                            'INVALID',\r\n                            '$redact expects one of $$PRUNE, $$KEEP, $$DESCEND'\r\n                        );\r\n\r\n                    var newDoc = {}\r\n                    var keys = Object.keys (readHead);\r\n                    for (var i in keys) {\r\n                        var key = keys[i];\r\n                        var val = readHead[key];\r\n                        if (typeof val != 'object')\r\n                            newDoc[key] = val;\r\n                        else {\r\n                            var newVal = redactLevel (val);\r\n                            if (newVal !== undefined)\r\n                                newDoc[key] = newVal;\r\n                        }\r\n                    }\r\n                    if (Object.keys (newDoc).length)\r\n                        return newDoc;\r\n                }) (val, newDoc, key);\r\n\r\n                if (redacted !== undefined)\r\n                    newDoc[key] = redacted;\r\n            }\r\n\r\n            output.push (newDoc);\r\n        }\r\n\r\n        return output;\r\n    },\r\n    '$skip':        function (docs, expression) {\r\n        return docs.slice (expression);\r\n    },\r\n    '$sort':        function (docs, expression) {\r\n        var output = [];\r\n        output.push.apply (output, docs);\r\n        output.sort (Sorting.getDocsort (expression));\r\n        return output;\r\n    },\r\n    '$unwind':      function (docs, path) {\r\n        var output = [];\r\n\r\n        var frags = path.slice (1).split ('.');\r\n        for (var i=0,j=docs.length; i<j; i++) {\r\n            var doc = docs[i];\r\n\r\n            // walk to the target array\r\n            var pointer = docs[i];\r\n            var notFound = false;\r\n            for (var k in frags) {\r\n                var frag = frags[k];\r\n                if (!Object.hasOwnProperty.call (pointer, frag)) {\r\n                    notFound = true;\r\n                    break;\r\n                }\r\n                pointer = pointer[frag];\r\n                if (typeof pointer != 'object')\r\n                    throw new FauxmongoError (\r\n                        'FORMAT',\r\n                        '$unwind found something other than an Array'\r\n                    );\r\n            }\r\n            if (notFound)\r\n                continue;\r\n            if (!(pointer instanceof Array))\r\n                throw new FauxmongoError (\r\n                    'FORMAT',\r\n                    '$unwind found something other than an Array'\r\n                );\r\n\r\n            // unwind\r\n            var newDocs = [];\r\n            for (var k in pointer) {\r\n                newDoc = clone (doc);\r\n                // walk to the unwound path and set an individual value there\r\n                var innerPointer = newDoc;\r\n                for (var l=0,m=frags.length-1; l<m; l++)\r\n                    innerPointer = innerPointer[frags[l]];\r\n                innerPointer[frags[frags.length-1]] = pointer[k];\r\n                newDocs.push (newDoc);\r\n            }\r\n            output.push.apply (output, newDocs);\r\n        }\r\n\r\n        return output;\r\n    }\r\n};\r\n\r\n\r\nmodule.exports = AggregationStages;\r\n","\r\n/**     @module/class fauxmongo/lib/FauxmongoError\r\n    @super Error\r\n    An Error generated intentionally by fauxmongo to describe a known error condition.\r\n@String #code\r\n    A reliable string value describing the general type of error being reported.\r\n     * **SUPPORT** the update, query or pipeline specification requests\r\n     * **INVALID** the update, query or pipeline specification was invalid\r\n     * **FORMAT** a record in the input set could not be processed by the aggregation pipeline\r\n        because a field was either missing or incorrectly typed.\r\n@String #message\r\n    Additional human-readable information about the error.\r\n*/\r\n\r\nvar util = require ('util');\r\n\r\nfunction FauxmongoError (code, message, info) {\r\n    Error.call (this);\r\n    this.code = code;\r\n    this.message = message;\r\n    if (info) for (var key in info) this[key] = info[key];\r\n}\r\nutil.inherits (FauxmongoError, Error);\r\n\r\nmodule.exports = FauxmongoError;\r\n","\r\nvar BSON_TYPES = {};\r\nBSON_TYPES['DOUBLE']        = 1;\r\nBSON_TYPES['STRING']        = 2;\r\nBSON_TYPES['OBJECT']        = 3;\r\nBSON_TYPES['ARRAY']         = 4;\r\nBSON_TYPES['BUFFER']        = 5;\r\nBSON_TYPES['UNDEFINED']     = 6;\r\nBSON_TYPES['OBJECT_ID']     = 7;\r\nBSON_TYPES['BOOLEAN']       = 8;\r\nBSON_TYPES['DATE']          = 9;\r\nBSON_TYPES['NULL']          = 10;\r\nBSON_TYPES['REGEXP']        = 11;\r\nBSON_TYPES['FUNCTION']      = 13;\r\nBSON_TYPES['INTEGER']       = 16;\r\nBSON_TYPES['LONG']          = 18;\r\nmodule.exports.BSON_TYPES   = BSON_TYPES;\r\n\r\n/**     @property/Function fauxmongo.getBSONType\r\n    @root\r\n    Return a numeric BSON type for a javascript object.\r\n@argument/Object subject\r\n    The object to test for type.\r\n@argument/Boolean simpleNums\r\n    @optional\r\n    In simpleNums mode, a Number is always of `DOUBLE` type. Otherwise it will be evaluated as\r\n    potentially an integer.\r\n@returns/Number\r\n    Returns one of the following values:\r\n     * 0 - unknown type\r\n     * 1 - double\r\n     * 2 - string\r\n     * 3 - object\r\n     * 4 - array\r\n     * 5 - buffer\r\n     * 6 - undefined\r\n     * 7 - ObjectID\r\n     * 8 - boolean\r\n     * 9 - date\r\n     * 10 - null\r\n     * 11 - regexp\r\n     * 13 - function\r\n     * 16 - integer\r\n     * 18 - long\r\n*/\r\nfunction getBSONType (obj, simpleNums) {\r\n    var type = getTypeStr (obj);\r\n    if (type == 'number') {\r\n        if (simpleNums) return 1;\r\n        if (Math.round (obj) == obj)\r\n            return 16;\r\n        return 1;\r\n    }\r\n    if (!BSON_TYPES.hasOwnProperty (type))\r\n        return 0;\r\n    return BSON_TYPES[type];\r\n}\r\n\r\nmodule.exports = getBSONType;\r\n","\r\nvar typeGetter = ({}).toString;\r\ntry { Buffer; } catch (err) { Buffer = function(){}; }\r\nfunction getTypeStr (obj) {\r\n    var tstr = typeGetter.apply(obj).slice(8,-1).toLowerCase();\r\n    if (tstr == 'object')\r\n        if (obj instanceof Buffer) return 'buffer';\r\n        else return tstr;\r\n    if (tstr == 'text') return 'textnode';\r\n    if (tstr == 'comment') return 'commentnode';\r\n    if (tstr.slice(0,4) == 'html') return 'element';\r\n    return tstr;\r\n}\r\n\r\nmodule.exports = getTypeStr;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\n\r\n/**     @property/Function fauxmongo.matchQuery.matchLeaves\r\n    @development\r\n    Compare two MongoDB documents, lists or leaves for deep equality.\r\n@argument able\r\n@argument baker\r\n@returns/Boolean\r\n*/\r\nfunction matchLeaves (able, baker) {\r\n    if (able === baker) return true;\r\n\r\n    var aType = getTypeStr (able);\r\n    var bType = getTypeStr (baker);\r\n    if (aType != bType) return false;\r\n    if (aType == 'array') {\r\n        if (able.length != baker.length) return false;\r\n        for (var i in able)\r\n            if (!matchLeaves (able[i], baker[i]))\r\n                return false;\r\n        return true;\r\n    } else if (aType == 'object') {\r\n        var keys = Object.keys (able);\r\n        if (keys.length != Object.keys (baker).length) return false;\r\n        for (var i in keys) {\r\n            var key = keys[i];\r\n            if (!Object.hasOwnProperty.call (baker, key) || !matchLeaves (able[key], baker[key]))\r\n                return false;\r\n        }\r\n        return true;\r\n    } else return false;\r\n}\r\n\r\nmodule.exports = matchLeaves;\r\n","\r\n/**     @property/Function fauxmongo.matchQuery\r\n    @root\r\n    @api\r\n    Determine whether a query selects a given document.\r\n@argument/Object doc\r\n    The document to be examined.\r\n@argument/Object query\r\n    The query to test against the document.\r\n@argument/String root\r\n    @optional\r\n    Indicates an offset document position. Permits testing a full query against a subdocument.\r\n@returns/Boolean\r\n*/\r\nfunction matchQuery (doc, query, root) {\r\n    var rootlen = root ? root.length : 0;\r\n    for (var path in query) {\r\n        var subquery = query[path];\r\n        if (root) {\r\n            if (path.slice (0, rootlen) != root)\r\n                continue;\r\n            path = path.slice (rootlen + 1);\r\n        }\r\n\r\n        if (path == '$where')\r\n            throw new Error ('$where is not supported');\r\n\r\n        var subtype = getTypeStr (subquery);\r\n\r\n        if (path == '$and') {\r\n            if (subtype != 'array')\r\n                throw new Error ('$and requires an Array of query documents');\r\n            for (var i=0,j=subquery.length; i<j; i++)\r\n                if (!matchQuery (doc, subquery[i]))\r\n                    return false;\r\n            continue;\r\n        }\r\n\r\n        if (path == '$or') {\r\n            if (subtype != 'array')\r\n                throw new Error ('$or requires an Array of query documents');\r\n            var fullfilled = false;\r\n            for (var i=0,j=subquery.length; i<j; i++)\r\n                if (matchQuery (doc, subquery[i])) {\r\n                    fullfilled = true;\r\n                    break;\r\n                }\r\n            if (!fullfilled) return false;\r\n            continue;\r\n        }\r\n\r\n        if (path == '$nor') {\r\n            if (subtype != 'array')\r\n                throw new Error ('$nor requires an Array of query documents');\r\n            for (var i=0,j=subquery.length; i<j; i++)\r\n                if (matchQuery (doc, subquery[i]))\r\n                    return false;\r\n            continue;\r\n        }\r\n\r\n        if (path[0] == '$')\r\n            return matchSubquery (doc, query);\r\n\r\n        var frags = path.split ('.');\r\n        var pointer = doc;\r\n        var pointerType = 'object';\r\n\r\n        // iterate all but the last frag\r\n        var ok = true;\r\n        var earlyMatch = false; // for child-of-Array queries\r\n        for (var i=0,j=frags.length-1; i<j; i++) {\r\n            var frag = frags[i];\r\n            if (frag[0] == '$') // operator in middle of path\r\n                throw new Error ('invalid path '+path);\r\n\r\n            if (pointerType == 'array') {\r\n                var index = parseInt (frag);\r\n                var upperSubpath = frags.slice (i+1).join ('.');\r\n                if (!isNaN (index) && frag.match (/^\\d+$/) && index < pointer.length) {\r\n                    // possible numeric index match\r\n                    var specialSubquery = {};\r\n                    specialSubquery[upperSubpath] = subquery;\r\n                    if (matchQuery (pointer[frag], specialSubquery)) {\r\n                        earlyMatch = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                var fullfilled = false;\r\n                upperSubpath = frag + '.' + upperSubpath;\r\n                var specialSubquery = {};\r\n                specialSubquery[upperSubpath] = subquery;\r\n                for (var i in pointer)\r\n                    if (matchQuery (pointer[i], specialSubquery)) {\r\n                        fullfilled = true;\r\n                        break;\r\n                    }\r\n                if (!fullfilled)\r\n                    return false;\r\n                earlyMatch = true;\r\n                break;\r\n            }\r\n\r\n            if (pointerType != 'object')\r\n                throw new Error ('Encountered a leaf in the middle of the path '+path);\r\n            if (frag[0] == '$') // operator in middle of path\r\n                throw new Error ('invalid path '+path);\r\n\r\n            if (!Object.hasOwnProperty.call (pointer, frag)) {\r\n                ok = false;\r\n                break;\r\n            }\r\n            pointer = pointer[frag];\r\n            pointerType = getTypeStr (pointer); // the business end of pointerType logic\r\n        }\r\n        if (earlyMatch) continue;\r\n\r\n        // we have navigated to the parent of the last fragment in the path\r\n        var frag = frags[frags.length-1];\r\n        if (frag[0] == '$')\r\n            throw new Error ('invalid path '+path);\r\n\r\n        if (pointerType == 'array') {\r\n            var index = parseInt (frag);\r\n            var upperSubpath = frags.slice (i+1).join ('.');\r\n            if (!isNaN (index) && frag.match (/^\\d+$/) && index < pointer.length) {\r\n                // possible numeric index match\r\n                if (matchLeaves (pointer[frag], subquery)) {\r\n                    earlyMatch = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            var fullfilled = false;\r\n            var specialSubquery = {};\r\n            specialSubquery[frag] = subquery;\r\n            for (var i in pointer)\r\n                if (matchQuery (pointer[i], specialSubquery)) {\r\n                    fullfilled = true;\r\n                    break;\r\n                }\r\n            if (!fullfilled)\r\n                return false;\r\n            earlyMatch = true;\r\n            break;\r\n        }\r\n\r\n        if (pointerType != 'object')\r\n            throw new Error ('Encountered a leaf in the middle of the path '+path);\r\n\r\n        // missing key?\r\n        if (!ok || !Object.hasOwnProperty.call (pointer, frag))\r\n            // still one thin ray of hope - $exists:false\r\n            if (\r\n                subtype == 'object'\r\n             && Object.hasOwnProperty.call (subquery, '$exists')\r\n             && !subquery.$exists\r\n            )\r\n                continue; // successfully matched { $exists:false }\r\n            else\r\n                return false; // missing key\r\n\r\n        if (subtype != 'object' || !moreDollars (subquery))\r\n            if (matchLeaves (pointer[frag], subquery))\r\n                continue;\r\n            else\r\n                return false;\r\n\r\n        // $operator-laden subquery\r\n        for (var op in subquery) {\r\n            // apply the operator\r\n            if (op == '$exists') // we know it does\r\n                continue;\r\n            if (!operators.ops[op] (\r\n                pointer[frag],\r\n                subquery[op]\r\n            ))\r\n                return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n\r\n/**     @property/Function matchSubquery\r\n    Test a partial query against a subdocument. Expects the query specification for a single key,\r\n    e.g. from `{ 'able.baker':{ $gt:4 } }` the subquery is `{ $gt:4 }`.\r\n@argument/Object document\r\n    Subdocument or leaf to test.\r\n@argument/Object subquery\r\n    Query specification for a single key.\r\n@returns/Boolean\r\n*/\r\nfunction matchSubquery (document, subquery) {\r\n    // $operator-laden subquery\r\n    for (var op in subquery) {\r\n        // apply the operator\r\n        if (op == '$exists') // we know it does\r\n            continue;\r\n        if (!operators.ops[op] (\r\n            document,\r\n            subquery[op]\r\n        ))\r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n\r\nmodule.exports = matchQuery;\r\nmatchQuery.matchSubquery = matchSubquery;\r\n\r\nvar operators = require ('./QueryOperators');\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar moreDollars = require ('./MoreDollars');\r\nvar matchLeaves = require ('./MatchLeaves');\r\nmatchQuery.matchLeaves = matchLeaves;\r\n","\r\n/**     @property/Function fauxmongo.merge\r\n    @root\r\n    @api\r\n    Recursively merge the result of a query into a local document, overwriting the document with\r\n    fresh query results. A projection specification may be provided to intelligently merge\r\n    projected fields.\r\n@argument/Object source\r\n    Freshly queried state information.\r\n@argument/Object target\r\n    The target document to recursively merge into.\r\n@argument/Object query\r\n    @optional\r\n    If the projection uses the positional operator, the query may be included to define its\r\n    position.\r\n@argument/Object projection\r\n    @optional\r\n    If a projection is provided, the merge will honor any special projection options.\r\n*/\r\n\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar resolveDollar = require ('./ResolveDollar');\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\nfunction simpleMerge (source, target) {\r\n    for (var key in source) {\r\n        var val = source[key];\r\n        if (!Object.hasOwnProperty.call (target, key)) {\r\n            target[key] = val;\r\n            continue;\r\n        }\r\n\r\n        var childType = getTypeStr (val);\r\n        var tval = target[key];\r\n        var tvalType = getTypeStr (tval);\r\n        if (childType != tvalType) {\r\n            target[key] = val;\r\n            continue;\r\n        }\r\n        if (childType == 'object')\r\n            simpleMerge (val, tval);\r\n        else if (childType == 'array')\r\n            simpleArrayMerge (val, tval);\r\n        else\r\n            target[key] = val;\r\n    }\r\n}\r\n\r\nfunction simpleArrayMerge (source, target) {\r\n    for (var i in source) {\r\n        var val = source[i];\r\n        if (i >= target.length) {\r\n            target.push (val);\r\n            continue;\r\n        }\r\n\r\n        var childType = getTypeStr (val);\r\n        var tval = target[i];\r\n        var tvalType = getTypeStr (tval);\r\n        if (childType != tvalType) {\r\n            target[i] = val;\r\n            continue;\r\n        }\r\n        if (childType == 'object')\r\n            simpleMerge (val, tval);\r\n        else if (childType == 'array')\r\n            simpleArrayMerge (val, tval);\r\n        else\r\n            target[i] = val;\r\n    }\r\n}\r\n\r\nfunction merge (source, target, query, projection) {\r\n    if (!projection) {\r\n        projection = query;\r\n        query = undefined;\r\n    }\r\n\r\n    if (!projection) // merging with no projection is MUCH simpler\r\n        return simpleMerge (source, target);\r\n\r\n    // projected merge\r\n    var dollarPath;\r\n    function mergeLevel (subsource, subtarget, basePath) {\r\n        for (var key in subsource) {\r\n            var val = subsource[key];\r\n            var childType = getTypeStr (val);\r\n            var keypath = basePath ? basePath + '.' + key : key;\r\n\r\n            if (!Object.hasOwnProperty.call (subtarget, key)) {\r\n                if (childType != 'array')\r\n                    subtarget[key] = val;\r\n                else {\r\n                    var newArr = subtarget[key] = [];\r\n                    mergeArrayLevel (val, newArr, keypath);\r\n                }\r\n                continue;\r\n            }\r\n\r\n            var tval = subtarget[key];\r\n            var tvalType = getTypeStr (tval);\r\n            if (childType != tvalType) {\r\n                subtarget[key] = val;\r\n                continue;\r\n            }\r\n            if (childType == 'object')\r\n                mergeLevel (val, tval, keypath);\r\n            else if (childType == 'array')\r\n                mergeArrayLevel (val, tval, keypath);\r\n            else\r\n                subtarget[key] = val;\r\n        }\r\n    }\r\n\r\n    function mergeArrayLevel (subsource, subtarget, basePath) {\r\n        if (!subsource.length)\r\n            return;\r\n        if (Object.hasOwnProperty.call (projection, basePath)) {\r\n            // special projection?\r\n            var directive = projection[basePath];\r\n            if (typeof directive == 'object')\r\n                if (directive.$elemMatch) {\r\n                    for (var i in subtarget)\r\n                        if (matchQuery (subtarget[i], directive.$elemMatch)) {\r\n                            subtarget[i] = subsource[0];\r\n                            return;\r\n                        }\r\n                    return;\r\n                } else if (directive.$slice) {\r\n                    // slice projection\r\n                    var start, end, dropped;\r\n                    if (typeof directive.$slice == 'number') {\r\n                        if (directive.$slice < 0)\r\n                            return; // cannot acquire a hard index for trailing elements\r\n                        start = 0;\r\n                        end = Math.min (subsource.length, directive.$slice);\r\n                    } else {\r\n                        // array of two indices\r\n                        if (directive.$slice[0] < 0)\r\n                            return;\r\n                        start = directive.$slice[0];\r\n                        end = start + directive.$slice[1];\r\n                        dropped = (end - start) - subsource.length;\r\n                    }\r\n\r\n                    for (var i=0,j=start; j < end; j++, i++)\r\n                        subtarget[j] = subsource[i];\r\n\r\n                    if (dropped)\r\n                        subtarget.splice (start + subsource.length, subtarget.length);\r\n\r\n                    return;\r\n                }\r\n        } else if (Object.hasOwnProperty.call (projection, basePath+'.$')) {\r\n            // positional operator projection\r\n            if (dollarPath)\r\n                throw new Error ('projection contains more than one positional operator');\r\n            dollarPath = basePath;\r\n            var dollarPosition = resolveDollar (target, query, basePath.split ('.'), basePath);\r\n            if (dollarPosition >= 0)\r\n                subtarget[dollarPosition] = subsource[0];\r\n            return;\r\n        }\r\n\r\n        for (var i in subsource) {\r\n            var val = subsource[i];\r\n            if (i >= subtarget.length) {\r\n                subtarget.push (val);\r\n                continue;\r\n            }\r\n\r\n            var childType = getTypeStr (val);\r\n            var tval = subtarget[i];\r\n            var tvalType = getTypeStr (tval);\r\n            if (childType != tvalType) {\r\n                subtarget[i] = val;\r\n                continue;\r\n            }\r\n            if (childType == 'object')\r\n                mergeLevel (val, tval, basePath);\r\n            else if (childType == 'array')\r\n                mergeArrayLevel (val, tval, basePath);\r\n            else\r\n                subtarget[i] = val;\r\n        }\r\n    }\r\n\r\n    mergeLevel (source, target);\r\n}\r\n\r\nmodule.exports = merge;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\n\r\nfunction moreDollars (level, isArray) {\r\n    if (isArray) {\r\n        for (var i in level) if (moreDollars (level[i])) return true;\r\n        return false;\r\n    }\r\n    for (var key in level) {\r\n        if (key[0] == '$')\r\n            return true;\r\n        var item = level[key];\r\n        var type = getTypeStr (item);\r\n        if (type == 'object')\r\n            if (moreDollars (item)) return true;\r\n            else continue;\r\n        if (type == 'array')\r\n            if (moreDollars (item, true)) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nmodule.exports = moreDollars;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar resolveDollar = require ('./ResolveDollar');\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\n/**     @property/Function fauxmongo.project\r\n    @root\r\n    Generate a document with another document using a MongoDB projection specification.\r\n@argument/Object document\r\n    The source document to project.\r\n@argument/Object query\r\n    @optional\r\n    If the projection uses the positional operator, provide a query to define it.\r\n@argument/Object projection\r\n    The projection specification used to generate a new document.\r\n*/\r\n\r\nfunction project (document, query, projection) {\r\n    if (!projection) {\r\n        projection = query;\r\n        query = undefined;\r\n    }\r\n\r\n    var outputDoc = {};\r\n    var dollarPath;\r\n    var previousStep, previousPPointer;\r\n    for (var path in projection) {\r\n        // in case we traverse any Arrays during this projection\r\n        function multiproject (pointer, target, path) {\r\n            var pointerType = getTypeStr (pointer);\r\n            var mainTarget;\r\n            if (target)\r\n                mainTarget = target;\r\n            else\r\n                if (pointerType == 'object')\r\n                    target = {};\r\n                else if (pointerType == 'array') {\r\n                    target = [];\r\n                    var remainingPath = path.slice (i);\r\n                    for (var i in pointer) {\r\n                        var found = multiproject (pointer[i], target[i], remainingPath);\r\n                        if (found !== undefined)\r\n                            target[i] = found;\r\n                    }\r\n                    return target;\r\n                } else\r\n                    return;\r\n\r\n            for (var i=0,j=path.length-1; i<j; i++) {\r\n                var pathStep = path[i];\r\n                if (pathStep == '$')\r\n                    throw new Error (\r\n                        'cannot use the positional operator inside another Array'\r\n                    );\r\n\r\n                if (pointerType == 'array') {\r\n                    if (!mainTarget) mainTarget = target;\r\n                    var remainingPath = path.slice (i);\r\n                    for (var k in pointer) {\r\n                        var found = multiproject (pointer[k], target[k], remainingPath);\r\n                        if (found !== undefined)\r\n                            target[k] = found;\r\n                    }\r\n                    return mainTarget;\r\n                } else if (pointerType != 'object')\r\n                    return mainTarget; // if there's path left, we must be a container type\r\n\r\n                if (!Object.hasOwnProperty.call (pointer, pathStep))\r\n                    return mainTarget; // not found\r\n                if (!mainTarget) mainTarget = target;\r\n                pointer = pointer[pathStep];\r\n                pointerType = getTypeStr (pointer);\r\n\r\n                if (Object.hasOwnProperty.call (target, pathStep))\r\n                    target = target[pathStep];\r\n                else\r\n                    if (pointerType == 'object')\r\n                        target = target[pathStep] = {};\r\n                    else\r\n                        target = target[pathStep] = [];\r\n            }\r\n\r\n            var finalStep = path[path.length-1];\r\n            if (!mainTarget) mainTarget = target;\r\n\r\n            if (pointerType == 'array') {\r\n                for (var k in pointer) {\r\n                    var found = multiproject (pointer[k], target[k], [ finalStep ]);\r\n                    if (found !== undefined)\r\n                        target[k] = found;\r\n                }\r\n                return mainTarget;\r\n            } else if (pointerType != 'object')\r\n                return mainTarget;\r\n\r\n            if (Object.hasOwnProperty.call (pointer, finalStep)) {\r\n                target[finalStep] = pointer[finalStep];\r\n                if (!mainTarget) mainTarget = target;\r\n            }\r\n            return mainTarget;\r\n        }\r\n\r\n        var directive = projection[path];\r\n\r\n        // walk the document to the projected leaves, if able\r\n        var pointer = document;\r\n        var ppointer = outputDoc;\r\n        var pathFrags = path.split ('.');\r\n        var broken = false;\r\n        var pointerType = 'object';\r\n        for (var i=0,j=pathFrags.length-1; i<j; i++) {\r\n            if (pointer === undefined) {\r\n                broken = true; // projected key not available because it is missing\r\n                break;\r\n            }\r\n            if (dollarPath && pathFrags.slice (0, i+1).join ('.') == dollarPath) {\r\n                // clobbered by dollarPath\r\n                // KEYWORD we could speed this up\r\n                broken = true;\r\n                break;\r\n            }\r\n\r\n            var pathStep = pathFrags[i];\r\n\r\n            // positional operator\r\n            if (pathStep == '$') {\r\n                if (pointerType != 'array')\r\n                    throw new Error ('positional operator requires an Array');\r\n                if (!query)\r\n                    throw new Error ('positional operator requires an query');\r\n                if (dollarPath)\r\n                    throw new Error ('cannot use the positional operator on more than one Array');\r\n\r\n                var dollarFrags = pathFrags.slice (0, i);\r\n                dollarPath = dollarFrags.join ('.');\r\n                var dollarPosition = resolveDollar (document, query, dollarFrags, dollarPath);\r\n                if (dollarPosition < 0) { // could not resolve - not found\r\n                    broken = true;\r\n                    break;\r\n                }\r\n                previousPPointer[previousStep] = [ pointer[dollarPosition] ];\r\n                broken = true;\r\n                break;\r\n            }\r\n\r\n            // array multiprojection\r\n            if (pointerType == 'array') {\r\n                var remainingPath = pathFrags.slice (i);\r\n                for (var i in pointer) {\r\n                    var docfrag = multiproject (pointer[i], ppointer[i], remainingPath);\r\n                    if (docfrag !== undefined)\r\n                        ppointer[i] = docfrag;\r\n                }\r\n                broken = true;\r\n                break;\r\n            }\r\n\r\n            // walk the pointer\r\n            previousPPointer = ppointer;\r\n            previousStep = pathStep;\r\n            pointer = pointer[pathStep];\r\n            pointerType = getTypeStr (pointer);\r\n\r\n            // walk ppointer, or infill\r\n            if (Object.hasOwnProperty.call (ppointer, pathStep))\r\n                ppointer = ppointer[pathStep];\r\n            else\r\n                if (pointerType == 'object')\r\n                    ppointer = ppointer[pathStep] = {};\r\n                else if (pointerType == 'array')\r\n                    ppointer = ppointer[pathStep] = [];\r\n                else { // this is an intermediate frag so, a.$.b but the elem $ isn't a container\r\n                    broken = true;\r\n                    break;\r\n                }\r\n        }\r\n        if (broken) // projected key was unavailable, we already processed it, whatever\r\n            continue;\r\n\r\n        var finalStep = pathFrags[pathFrags.length-1];\r\n\r\n        // array multiprojection\r\n\r\n        if (finalStep != '$')\r\n            if (pointerType != 'array')\r\n                pointer = pointer[finalStep];\r\n            else {\r\n                for (var i in pointer) {\r\n                    var docfrag = multiproject (pointer[i], ppointer[i], [ finalStep ]);\r\n                    if (docfrag !== undefined)\r\n                        ppointer[i] = docfrag;\r\n                }\r\n                continue\r\n            }\r\n        else {\r\n            if (pointerType != 'array')\r\n                throw new Error ('positional operator requires an Array');\r\n            if (!query)\r\n                throw new Error ('positional operator requires an query');\r\n            if (dollarPath)\r\n                throw new Error ('cannot use the positional operator on more than one Array');\r\n\r\n            var dollarFrags = pathFrags.slice (0, i);\r\n            dollarPath = dollarFrags.join ('.');\r\n            var dollarPosition = resolveDollar (document, query, dollarFrags, dollarPath);\r\n            if (dollarPosition < 0) // could not resolve - not found\r\n                continue\r\n            previousPPointer[previousStep] = [ pointer[dollarPosition] ];\r\n            continue;\r\n        }\r\n\r\n        // simple projection? { a.b.c:1 }\r\n        if (\r\n            !Object.hasOwnProperty.call (directive, '$elemMatch')\r\n         && !Object.hasOwnProperty.call (directive, '$slice')\r\n        ) {\r\n            if (pointer !== undefined) {\r\n                var leafTypeStr = getTypeStr (pointer);\r\n                if (leafTypeStr != 'array')\r\n                    ppointer[finalStep] = pointer;\r\n                else {\r\n                    var newCloneArr = ppointer[finalStep] = [];\r\n                    newCloneArr.push.apply (newCloneArr, pointer);\r\n                }\r\n            }\r\n\r\n            continue;\r\n        }\r\n\r\n        // complex projection\r\n        if (!(pointer instanceof Array))\r\n            continue;\r\n\r\n        // $elemMatch\r\n        if (directive.$elemMatch) {\r\n            ppointer = ppointer[finalStep] = [];\r\n            for (var k in pointer)\r\n                if (matchQuery (pointer[k], directive.$elemMatch)) {\r\n                    ppointer.push (pointer[k]);\r\n                    break;\r\n                }\r\n            continue;\r\n        }\r\n\r\n        // $slice\r\n        if (directive.$slice) {\r\n            if (directive.$slice instanceof Number)\r\n                if (directive.$slice >= 0)\r\n                    ppointer[finalStep] = pointer.slice (0, directive.$slice);\r\n                else\r\n                    ppointer[finalStep] = pointer.slice (directive.$slice);\r\n            else if (!(directive.$slice instanceof Array))\r\n                throw new Error ('$slice requires an Array of boundary indices');\r\n            ppointer[finalStep] = pointer.slice (\r\n                directive.$slice[0],\r\n                directive.$slice[0] + directive.$slice[1]\r\n            );\r\n\r\n            continue;\r\n        }\r\n\r\n        throw new Error ('unsupported query option '+JSON.stringify (directive));\r\n    }\r\n\r\n    return outputDoc;\r\n}\r\n\r\nmodule.exports = project;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar matchLeaves = require ('./MatchLeaves');\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\nvar LOOKUP_BSON_TYPE = {\r\n    1:  'number',\r\n    2:  'string',\r\n    3:  'object',\r\n    4:  'array',\r\n    5:  'buffer',\r\n    6:  'undefined',\r\n    8:  'boolean',\r\n    9:  'date',\r\n    10: 'null',\r\n    11: 'regexp',\r\n    13: 'function',\r\n    16: 'number',\r\n    18: 'number'\r\n};\r\n\r\nvar fieldOps = {\r\n    '$not':         function $not (val, query) {\r\n        if (getTypeStr (val) != 'object')\r\n            throw new Error ('$not requires a query document');\r\n        if (matchQuery (val, query))\r\n            return false;\r\n        return true;\r\n    },\r\n    '$gt':          function $gt (val, query) {\r\n        if (typeof val != 'number' || typeof query != 'number' || val <= query)\r\n            return false;\r\n        return true;\r\n    },\r\n    '$gte':         function $gte (val, query) {\r\n        if (typeof val != 'number' || typeof query != 'number' || val < query)\r\n            return false;\r\n        return true;\r\n    },\r\n    '$in':          function $in (val, query) {\r\n        if (getTypeStr (query) != 'array')\r\n            throw new Error ('$in requires an Array');\r\n\r\n        var isString = typeof val == 'string';\r\n        for (var i in query) {\r\n            var subquery = query[i];\r\n            if (getTypeStr (subquery) == 'regexp') {\r\n                if (!isString) continue;\r\n                else if (val.match (subquery))\r\n                    return true;\r\n            } else if (matchLeaves (subquery, val))\r\n                return true;\r\n        }\r\n        return false;\r\n    },\r\n    '$lt':          function $lt (val, query) {\r\n        if (typeof val != 'number' || typeof query != 'number' || val >= query)\r\n            return false;\r\n        return true;\r\n    },\r\n    '$lte':         function $lte (val, query) {\r\n        if (typeof val != 'number' || typeof query != 'number' || val > query)\r\n            return false;\r\n        return true;\r\n    },\r\n    '$ne':          function $ne (val, query) {\r\n        if (matchLeaves (val, query))\r\n            return false;\r\n        return true;\r\n    },\r\n    '$nin':         function $nin (val, query) {\r\n        if (getTypeStr (query) != 'array')\r\n            throw new Error ('$nin requires an Array');\r\n\r\n        var isString = typeof val == 'string';\r\n        for (var i in query) {\r\n            var subquery = query[i];\r\n            if (getTypeStr (subquery) == 'regexp') {\r\n                if (!isString) continue;\r\n                else if (val.match (subquery))\r\n                    return false;\r\n            } else if (matchLeaves (query[i], val))\r\n                return false;\r\n        }\r\n        return true;\r\n    },\r\n    '$mod':         function $mod (val, query) {\r\n        if (getTypeStr (query) != 'array' || query.length != 2)\r\n            throw new Error ('$in requires an Array of [ divisor, remainder ]');\r\n\r\n        if (typeof val != 'number') return false;\r\n\r\n        if (val % query[0] == query[1])\r\n            return true;\r\n        return false;\r\n    },\r\n    '$regex':       function $regex (val, query) {\r\n        if (getTypeStr (query) != 'regexp')\r\n            throw new Error ('$regex requires a RegExp');\r\n\r\n        if (typeof val != 'string')\r\n            return false;\r\n        return val.match (query) ? true : false;\r\n    },\r\n    '$type':        function $type (val, query) {\r\n        if (getTypeStr (query) != 'number')\r\n            throw new Error ('$type requires a BSON type integer');\r\n        if (!LOOKUP_BSON_TYPE.hasOwnProperty (query))\r\n            return false;\r\n        return getTypeStr (val) == LOOKUP_BSON_TYPE[query];\r\n    }\r\n};\r\n\r\n\r\nvar arrOps = {\r\n    '$all':         function $all (arr, query) {\r\n        if (getTypeStr (query) != 'array')\r\n            throw new Error ('$all requires an Array of values');\r\n        if (!arr.length) return true;\r\n\r\n        var clone = [];\r\n        clone.push.apply (clone, query);\r\n        for (var i in arr)\r\n            for (var j=0,k=clone.length; j<k; j++)\r\n                if (matchLeaves (arr[i], clone[j])) {\r\n                    clone.splice (j, 1);\r\n                    j--; k--;\r\n                    if (!k) return true;\r\n                }\r\n        return false;\r\n    },\r\n    '$elemMatch':   function $elemMatch (arr, query) {\r\n        if (getTypeStr (query) != 'object')\r\n            throw new Error ('$elemMatch requires a query document');\r\n        for (var i in arr)\r\n            if (matchQuery (arr[i], query))\r\n                return true;\r\n        return false;\r\n    },\r\n    '$size':        function $size (arr, query) {\r\n        if (getTypeStr (query) != 'number')\r\n            throw new Error ('$size requires an integer');\r\n        if (arr.length == query)\r\n            return true;\r\n        return false;\r\n    }\r\n};\r\n\r\n\r\nvar ops = {};\r\nfor (var key in fieldOps) ops[key] = fieldOps[key];\r\nfor (var key in arrOps) ops[key] = arrOps[key];\r\n\r\nmodule.exports.ops = ops;\r\nmodule.exports.fieldOps = fieldOps;\r\nmodule.exports.arrOps = arrOps;\r\n","\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\n/**     @property/Function fauxmongo.resolveDollar\r\n    @root\r\n    @development\r\n    Determine the numeric index, if any, of a value matching the positional operator. The prefix\r\n    path where the positional operator was found is required, e.g. `comments.$.author` uses the path\r\n    `comments`.\r\n\r\n    Both `path` and `pathstr` are required (not generated) because if you are calling\r\n    `resolveDollar` you probably have or need both of these anyway.\r\n@argument/Object target\r\n    The outer document to search. Must have the same root as the `path` and `pathstr` arguments.\r\n@argument/Object query\r\n    The query object used to generate the positional operator.\r\n@argument/Array path\r\n    The prefix path where the positional operator was found, as an Array of keys.\r\n@argument/String pathstr\r\n    The prefix path where the positional operator was found, as a dot-delimited String.\r\n*/\r\nfunction resolveDollar (target, query, path, pathstr) {\r\n    // scan the target for paths that begin with the supplied path.\r\n    // there can be more than one - the last path that matches an element sets the dollarsign op\r\n    // first, walk the target to the array in question\r\n    var pointer = target;\r\n    for (var i in path)\r\n        pointer = pointer[path[i]];\r\n    if (!pointer.length) return -1;\r\n\r\n    var pslen = pathstr.length;\r\n    var dollar = -1;\r\n\r\n    var didDocumentQuery = false;\r\n    for (var qpath in query) {\r\n        if (qpath.slice (0, pslen) != pathstr)\r\n            continue;\r\n        var subquery = query[qpath];\r\n        if (subquery instanceof Object) {\r\n            if (Object.hasOwnProperty.call (subquery, '$elemMatch')) {\r\n                // elemMatch query\r\n                for (var i in pointer)\r\n                    if (matchQuery (pointer[i], subquery.$elemMatch)) {\r\n                        dollar = i;\r\n                        break;\r\n                    }\r\n                if (dollar >= 0)\r\n                    return dollar;\r\n                continue;\r\n            }\r\n        }\r\n\r\n        if (didDocumentQuery)\r\n            continue; // whatever, nerd!\r\n\r\n        var dummyQuery = {};\r\n        dummyQuery[qpath.slice (pslen+1)] = subquery;\r\n        for (var i in pointer)\r\n            if (matchQuery (pointer[i], dummyQuery)) {\r\n                try {\r\n                    var keys = Object.keys (subquery);\r\n                    if (keys.length && keys[0][0] == '$')\r\n                        didDocumentQuery = true;\r\n                } catch (err) { /* subquery isn't an Object */ }\r\n                dollar = i;\r\n                break;\r\n            }\r\n    }\r\n\r\n    return dollar;\r\n}\r\n\r\nmodule.exports = resolveDollar;\r\n","\r\n/**     @module/class fauxmongo.Set\r\n    @development\r\n    Collects a set of unique MongoDB documents.\r\n@argument/Array values\r\n*/\r\n\r\nvar matchLeaves = require ('./MatchQuery').matchLeaves;\r\nvar getTypeStr = require ('./GetTypeStr');\r\n\r\nfunction Set (values) {\r\n    this.strings = {};\r\n    this.nums = {};\r\n    this.others = [];\r\n\r\n    if (values) for (var i in values) {\r\n        var val = values[i];\r\n        var type = getTypeStr (val);\r\n        if (type == 'string')\r\n            this.strings[val] = true;\r\n        else if (type == 'number')\r\n            this.nums[val] = true;\r\n        else {\r\n            var found = false;\r\n            for (var j in this.others)\r\n                if (matchLeaves (val, this.others[j])) {\r\n                    found = true;\r\n                    break;\r\n                }\r\n            if (!found)\r\n                this.others.push (val);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**     @member/Function union\r\n    @development\r\n    Add another Set's values to this Set.\r\n@argument/.Set other\r\n*/\r\nSet.prototype.union = function (other) {\r\n    for (var key in other.strings)\r\n        this.strings[key] = true;\r\n    for (var key in other.nums)\r\n        this.nums[key] = true;\r\n    for (var i in other.others) {\r\n        var found = false;\r\n        for (var j in this.others)\r\n            if (matchLeaves (other.others[i], this.others[j])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        if (!found)\r\n            this.others.push (other.others[i]);\r\n    }\r\n};\r\n\r\n\r\n/**     @member/Function difference\r\n    @development\r\n    Remove another Set's values from this Set.\r\n@argument/.Set other\r\n*/\r\nSet.prototype.difference = function (other) {\r\n    for (var key in other.strings)\r\n        delete this.strings[key];\r\n    for (var key in other.nums)\r\n        delete this.nums[key];\r\n    for (var oi in other.others)\r\n        for (var i=0,j=this.others.length; i<j; i++)\r\n            if (matchLeaves (this.others[i], other.others[oi])) {\r\n                this.others.splice (i, 1);\r\n                i--; j--;\r\n                break;\r\n            }\r\n};\r\n\r\n\r\n/**     @member/Function intersect\r\n    @development\r\n    Create a new Set containing only values which appear in both this Set and another Set.\r\n@argument/.Set other\r\n@returns/.Set newSet\r\n*/\r\nSet.prototype.intersect = function (other) {\r\n    var newSet = new Set ([]);\r\n    for (var key in other.strings)\r\n        if (Object.hasOwnProperty.call (this.strings, key))\r\n            newSet.strings[key] = true;\r\n    for (var key in other.nums)\r\n        if (Object.hasOwnProperty.call (this.nums, key))\r\n            newSet.nums[key] = true;\r\n    for (var oi in other.others)\r\n        for (var i=0,j=this.others.length; i<j; i++)\r\n            if (matchLeaves (this.others[i], other.others[oi])) {\r\n                newSet.others.push (this.others[i]);\r\n                break;\r\n            }\r\n\r\n    return newSet;\r\n};\r\n\r\n\r\n/**     @member/Function equals\r\n    @development\r\n    Determine whether this Set contains the exact same collection of values as another Set.\r\n@argument/.Set other\r\n@returns/Boolean\r\n*/\r\nSet.prototype.equals = function (other) {\r\n    if (this.others.length != other.others.length)\r\n        return false;\r\n\r\n    var strings = Object.keys (this.strings);\r\n    var nums = Object.keys (this.nums);\r\n    var otherStrings = Object.keys (other.strings);\r\n    var otherNums = Object.keys (other.nums);\r\n\r\n    if (strings.length != otherStrings.length || nums.length != otherNums.length)\r\n        return false;\r\n\r\n    for (var i in strings)\r\n        if (!Object.hasOwnProperty.call (other.strings, strings[i]))\r\n            return false;\r\n\r\n    for (var i in nums)\r\n        if (!Object.hasOwnProperty.call (other.nums, nums[i]))\r\n            return false;\r\n\r\n    for (var i in this.others) {\r\n        var found = false;\r\n        for (var j in other.others)\r\n            if (matchLeaves (other.others[j], this.others[i])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        if (!found)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n\r\n/**     @member/Function contains\r\n    @development\r\n    Determine whether every value in another Set is also contained in this Set.\r\n@argument/.Set other\r\n@returns/Boolean\r\n*/\r\nSet.prototype.contains = function (other) {\r\n    for (var key in other.strings)\r\n        if (!Object.hasOwnProperty.call (this.strings, key))\r\n            return false;\r\n\r\n    for (var key in other.nums)\r\n        if (!Object.hasOwnProperty.call (this.nums, key))\r\n            return false;\r\n\r\n    for (var i in other.others) {\r\n        var found = false;\r\n        for (var j in this.others)\r\n            if (matchLeaves (this.others[j], other.others[i])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        if (!found) return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n\r\n/**     @member/Function add\r\n    @development\r\n    Add a value to this Set and return whether or not the value was previously unknown.\r\n@argument value\r\n@returns/Boolean `true` if the item was added, `false` if it was already there.\r\n*/\r\nSet.prototype.add = function (val) {\r\n    var type = getTypeStr (val);\r\n    if (type == 'string' && !Object.hasOwnProperty.call (this.nums, val))\r\n        this.strings[val] = true;\r\n    else if (type == 'number' && !Object.hasOwnProperty.call (this.nums, String (val)))\r\n        this.nums[val] = true;\r\n    else {\r\n        var found = false;\r\n        for (var j in this.others)\r\n            if (matchLeaves (val, this.others[j])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        if (!found) {\r\n            this.others.push (val);\r\n            return true;\r\n        }\r\n    }\r\n};\r\n\r\n\r\n/**     @member/Function export\r\n    Create an Array of every value stored in this Set.\r\n@returns/Array\r\n    An Array of unique elements in this Set.\r\n*/\r\nSet.prototype.export = function(){\r\n    var vals = Object.keys (this.strings);\r\n    vals.push.apply (vals, Object.keys (this.nums).map (Number));\r\n    vals.push.apply (vals, this.others);\r\n    return vals;\r\n};\r\n\r\n\r\nmodule.exports = Set;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\n\r\nvar ARR_SORT_PRIORITY = [\r\n    'null', 'number', 'string', 'object', 'array', 'buffer', 'boolean', 'date', 'regexp'\r\n];\r\nvar SORT_PRIORITY = {};\r\nfor (var i in ARR_SORT_PRIORITY) SORT_PRIORITY[ARR_SORT_PRIORITY[i]] = i;\r\n\r\n/**     @module fauxmongo.Sorting\r\n    Generate sorter Functions for ordering documents and leaves.\r\n*/\r\n\r\n/**     @property/Function getLeafSort\r\n    @development\r\n    @private\r\n    Creates a simple sort function closing on the desired sort polarity. MongoDB documents are\r\n    compared as leaf data, with data type being the highest priority.\r\n@argument/Number sspec\r\n@returns/Function\r\n*/\r\nfunction getLeafsort (sspec) {\r\n    sspec *= -1;\r\n    function leafsort (able, baker) {\r\n        if (able === baker) return 0;\r\n        var aType = getTypeStr (able);\r\n        var bType = getTypeStr (baker);\r\n        if (aType != bType)\r\n            return Math.max (-1, Math.min (1,\r\n                sspec * (SORT_PRIORITY[bType] - SORT_PRIORITY[aType])\r\n            ));\r\n        if (aType == 'number')\r\n            return Math.max (-1, Math.min (1, sspec * (baker - able)));\r\n        if (aType == 'string')\r\n            if (baker > able)\r\n                return sspec;\r\n            else\r\n                return -1 * sspec;\r\n        if (aType == 'object') {\r\n            var aKeys = Object.keys (able)[0];\r\n            var bKeys = Object.keys (baker)[0];\r\n            for (var i in bKeys) {\r\n                if (aKeys[i] == bKeys[i]) { // recurse\r\n                    var comp = leafsort (able[aKeys[i]], baker[aKeys[i]]);\r\n                    if (comp) return comp;\r\n                } else if (bKeys[i] > aKeys[i])\r\n                    return sspec;\r\n                else\r\n                    return -1 * sspec;\r\n            }\r\n        }\r\n        if (aType == 'array') {\r\n            if (!aType.length)\r\n                if (bType.length) return 1;\r\n                else return 0;\r\n            if (!bType.length)\r\n                if (aType.length) return -1;\r\n                else return 0;\r\n            if (sspec > 0) { // find highest\r\n                var aHighest = able[0];\r\n                var bHighest = baker[0];\r\n                for (var i=1,j=able.length; i<j; i++) // recurse\r\n                    if (sspec * leafsort (aHighest, able[i]) > 0)\r\n                        aHighest = able[i];\r\n                for (var i=1,j=baker.length; i<j; i++) // recurse\r\n                    if (sspec * leafsort (bHighest, able[i]) > 0)\r\n                        bHighest = baker[i];\r\n                // recurse\r\n                return leafsort (aHighest, bHighest);\r\n            } else { // find lowest\r\n                var aLowest = able[0];\r\n                var bLowest = baker[0];\r\n                for (var i=1,j=able.length; i<j; i++) // recurse\r\n                    if (sspec * leafsort (aLowest, able[i]) < 0)\r\n                        aLowest = able[i];\r\n                for (var i=1,j=baker.length; i<j; i++) // recurse\r\n                    if (sspec * leafsort (bLowest, able[i]) < 0)\r\n                        bLowest = baker[i];\r\n                // recurse\r\n                return leafsort (aLowest, bLowest);\r\n            }\r\n        }\r\n        if (aType == 'buffer')\r\n            if (able.length != baker.length)\r\n                return Math.max (-1, Math.min (1, sspec * (baker.length - able.length)));\r\n            else {\r\n                for (var i=0,j=able.length; i<j; i++)\r\n                    if (able[i] != baker[i])\r\n                        return Math.max (-1, Math.min (1,\r\n                            sspec * (Number(baker[i]) - Number(able[i]))\r\n                        ));\r\n                return 0;\r\n            }\r\n        if (aType == 'boolean')\r\n            if (bType) return sspec;\r\n            else return -1 * sspec;\r\n        if (aType == 'date')\r\n            if (baker > able)\r\n                return sspec;\r\n            else\r\n                return -1 * sspec;\r\n\r\n        // all other types are considered indistinguishable to sort\r\n        return 0;\r\n    }\r\n\r\n    return leafsort;\r\n}\r\n\r\n\r\n/**     @property/Function getDocSort\r\n    @development\r\n    @private\r\n    Creates a complex sort function closing on the provided specification document. Documents are\r\n    compared according to the specification.\r\n@argument/Object sspec\r\n@returns/Function\r\n    A Function suitable for use with [standard sorting](Array#sort).\r\n*/\r\nfunction getDocsort (sspec) {\r\n    var leafsort = getLeafsort (1);\r\n    var specPaths = [];\r\n    var specFullpaths = Object.keys (sspec);\r\n    for (var key in sspec)\r\n        if (key.match (/\\$/))\r\n            throw new Error ('invalid sort path '+key);\r\n        else\r\n            specPaths.push (key.split ('.'));\r\n\r\n    return function (able, baker) {\r\n        for (var i in specPaths) {\r\n            var path = specPaths[i];\r\n            var aPointer = able;\r\n            var bPointer = baker;\r\n            var direction = sspec[specFullpaths[i]] > 0 ? 1 : -1;\r\n            for (var j in path) {\r\n                var frag = path[j];\r\n                if (!Object.hasOwnProperty.call (able, frag))\r\n                    if (Object.hasOwnProperty.call (baker, frag))\r\n                        return direction;\r\n                    else continue;\r\n                if (!Object.hasOwnProperty.call (baker, frag))\r\n                    if (Object.hasOwnProperty.call (able, frag))\r\n                        return -1 * direction;\r\n                    else continue;\r\n                aPointer = aPointer[frag];\r\n                bPointer = bPointer[frag];\r\n            }\r\n            var comp = direction * leafsort (aPointer, bPointer);\r\n            if (comp) return comp;\r\n        }\r\n        return 0;\r\n    };\r\n}\r\n\r\n\r\nmodule.exports.getLeafsort = getLeafsort;\r\nmodule.exports.getDocsort = getDocsort;\r\n","\r\n/**     @property/Function fauxmongo.update\r\n    @root\r\n    Apply a MongoDB update operation in place.\r\n@argument/Object query\r\n    @optional\r\n    If the update uses the positional operator, provide a query to define it.\r\n@argument/Object target\r\n    The document to update. This document will be modified.\r\n@argument/Object change\r\n    The update specification to apply.\r\n*/\r\n\r\nvar MOD_OPS = {\r\n    '$each':        true,\r\n    '$position':    true,\r\n    '$slice':       true,\r\n    '$sort':        true\r\n};\r\n\r\nvar STUBBORN_OPS = {\r\n    '$set':         true,\r\n    '$inc':         true,\r\n    '$min':         true,\r\n    '$max':         true,\r\n    '$mul':         true,\r\n    '$currentDate': true,\r\n    '$addToSet':    true,\r\n    '$push':        true,\r\n    '$pushAll':     true\r\n};\r\n\r\nfunction update (query, target, change) {\r\n    if (!change) {\r\n        change = target;\r\n        target = query;\r\n        query = undefined;\r\n    }\r\n\r\n    // $rename\r\n    if (Object.hasOwnProperty.call (change, '$rename'))\r\n        for (var oldPath in change.$rename) {\r\n            // acquire the value assigned to the current path, if able\r\n            // else skip this path\r\n            var pointer = target;\r\n            var notOK;\r\n            var frags = oldPath.split ('.');\r\n            for (var i in frags) {\r\n                var type = getTypeStr (pointer);\r\n                if (type != 'object' && type != 'array')\r\n                    throw new Error ('cannot traverse data to rename path '+oldPath);\r\n\r\n                var frag = frags[i];\r\n                if (frag[0] == '$')\r\n                    throw new Error ('cannot rename dynamic path '+oldPath);\r\n                if (!Object.hasOwnProperty.call (pointer, frag)) { // value not found\r\n                    notOK = true;\r\n                    break;\r\n                }\r\n                pointer = pointer[frag];\r\n            }\r\n            if (notOK) continue; // try the next path\r\n\r\n            var newPath = change.$rename[oldPath];\r\n            if (!Object.hasOwnProperty.call (change, '$set'))\r\n                change.$set = {};\r\n            // what do you think about the newPath?\r\n            if (Object.hasOwnProperty.call (change.$set, newPath))\r\n                throw new Error ('cannot rename more than one value to the same path '+newPath);\r\n            change.$set[newPath] = pointer;\r\n            if (!Object.hasOwnProperty.call (change, '$unset'))\r\n                change.$unset = {};\r\n            change.$unset[oldPath] = true;\r\n        }\r\n\r\n    var dollarTarget, dollarTargetStr; // only one key can use the $ operator at a time\r\n    for (var op in change) {\r\n        var job = change[op];\r\n\r\n        if (!operators.ops.hasOwnProperty (op))\r\n            throw new Error ('unrecognized operator '+op);\r\n        if (op == '$rename' || op == '$isolated') continue;\r\n\r\n        var stubborn = STUBBORN_OPS.hasOwnProperty (op); // whether to infill missing props\r\n        for (var path in job) {\r\n            var writing = false; // whether CURRENTLY infilling missing props\r\n            var frags = path.split ('.');\r\n            var pointer = target;\r\n            var pointerType = 'object';\r\n\r\n            // iterate all but the last frag\r\n            var ok = true;\r\n            for (var i=0,j=frags.length-1; i<j; i++) {\r\n                if (pointerType != 'object' && pointerType != 'array')\r\n                    throw new Error ('Encountered a leaf in the middle of the path '+path);\r\n                var frag = frags[i];\r\n\r\n                // dollar operator handling\r\n                if (frag == '$') {\r\n                    if (writing) { // if the key doesn't exist, the positional operator is useless\r\n                        ok = false;\r\n                        break;\r\n                    }\r\n                    if (pointerType != 'array')\r\n                        throw new Error (\r\n                            'Found a non-Array ('\r\n                          + pointerType\r\n                          + ') at the $ operator in path '\r\n                          + path\r\n                        );\r\n                    if (!i)\r\n                        throw new Error (\r\n                            'The path '+path+' is invalid because it begins with the $ operator.'\r\n                        );\r\n                    var newDollar = frags.slice (0, i);\r\n                    var newDollarStr = newDollar.join ('.');\r\n                    if (dollarTarget !== undefined && newDollarStr != dollarTargetStr)\r\n                        throw new Error (\r\n                            'The $ operator may only be used on one field (at '+path+')'\r\n                        );\r\n                    dollarTarget = newDollar;\r\n                    dollarTargetStr = newDollarStr;\r\n                    frag = resolveDollar (target, query, dollarTarget, dollarTargetStr);\r\n                    if (frag < 0) continue;\r\n\r\n                    pointer = pointer[frag];\r\n                    pointerType = 'array';\r\n                    continue;\r\n                } else if (frag[0] == '$') // operator in middle of path\r\n                    throw new Error ('invalid path '+path);\r\n\r\n                // normal path fragment\r\n                if (writing) {\r\n                    pointer = pointer[frag] = {};\r\n                    continue;\r\n                }\r\n                if (Object.hasOwnProperty.call (pointer, frag)) {\r\n                    pointer = pointer[frag];\r\n                    pointerType = getTypeStr (pointer); // the business end of pointerType logic\r\n                    continue;\r\n                }\r\n                if (!stubborn) {\r\n                    ok = false;\r\n                    break;\r\n                }\r\n                writing = true;\r\n                pointer = pointer[frag] = {};\r\n                pointerType = 'object';\r\n            }\r\n            if (!ok) continue;\r\n\r\n            // we have navigated to the parent of the last fragment in the path\r\n            if (pointerType != 'object' && pointerType != 'array')\r\n                throw new Error ('Encountered a leaf in the middle of the path '+path);\r\n\r\n            var frag = frags[frags.length-1];\r\n            // handle the $ operator\r\n            if (frag == '$') {\r\n                if (writing) // if the key is missing, the positional operator is useless\r\n                    continue;\r\n                if (pointerType != 'array')\r\n                    throw new Error (\r\n                        'Found a non-Array ('\r\n                      + pointerType\r\n                      + ') at the $ operator in path '\r\n                      + path\r\n                    );\r\n\r\n                var newDollar = frags.slice (0, i);\r\n                var newDollarStr = newDollar.join ('.');\r\n                if (dollarTarget !== undefined && newDollarStr != dollarTargetStr)\r\n                    throw new Error (\r\n                        'The $ operator may only be used on one field (at '+path+')'\r\n                    );\r\n                dollarTarget = newDollar;\r\n                dollarTargetStr = newDollarStr;\r\n                frag = resolveDollar (target, query, dollarTarget, dollarTargetStr);\r\n                if (frag < 0) continue;\r\n            } else if (frag[0] == '$')\r\n                throw new Error ('invalid path '+path);\r\n\r\n            // array operations require pointer[frag] to be an array\r\n            if (operators.arrOps.hasOwnProperty (op))\r\n                if (pointer[frag] === undefined)\r\n                    if (stubborn)\r\n                        pointer[frag] = [];\r\n                    else continue;\r\n                else if (getTypeStr (pointer[frag]) != 'array')\r\n                    throw new Error ('cannot apply '+op+' to non-array value');\r\n\r\n            // apply the operator\r\n            operators.ops[op] (\r\n                pointer,\r\n                frag,\r\n                job[path]\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = update;\r\nvar operators = require ('./UpdateOperators');\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar resolveDollar = require ('./ResolveDollar');\r\nupdate.resolveDollar = resolveDollar;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar Sorting = require ('./Sorting');\r\nvar moreDollars = require ('./MoreDollars');\r\nvar matchLeaves = require ('./MatchLeaves');\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\n\r\nvar fieldOps = {\r\n    '$set':         function $set (pointer, path, change) {\r\n        var changeType = getTypeStr (change);\r\n        if (\r\n            (changeType == 'object' && moreDollars (change))\r\n         || (changeType == 'array' && moreDollars (change, true))\r\n        )\r\n            throw new Error ('invalid property key in complex update');\r\n\r\n        pointer[path] = change;\r\n    },\r\n    '$inc':         function $inc (pointer, path, change) {\r\n        if (getTypeStr (change) != 'number')\r\n            throw new Error ('cannot $inc by a non-numeric value');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = change;\r\n        else\r\n            if (getTypeStr (pointer[path]) != 'number')\r\n                throw new Error ('cannot apply $inc on a non-numeric value');\r\n            else\r\n                pointer[path] += change;\r\n    },\r\n    '$min':         function $min (pointer, path, change) {\r\n        if (getTypeStr (change) != 'number')\r\n            throw new Error ('cannot $min to a non-numeric value');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = change;\r\n        else\r\n            if (getTypeStr (pointer[path]) != 'number')\r\n                throw new Error ('cannot apply $min on a non-numeric value');\r\n            else\r\n                pointer[path] = Math.min (pointer[path], change);\r\n    },\r\n    '$max':         function $max (pointer, path, change) {\r\n        if (getTypeStr (change) != 'number')\r\n            throw new Error ('cannot $max to a non-numeric value');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = change;\r\n        else\r\n            if (getTypeStr (pointer[path]) != 'number')\r\n                throw new Error ('cannot apply $max on a non-numeric value');\r\n            else\r\n                pointer[path] = Math.max (pointer[path], change);\r\n    },\r\n    '$mul':         function $mul (pointer, path, change) {\r\n        if (getTypeStr (change) != 'number')\r\n            throw new Error ('cannot $mul by a non-numeric value');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = 0;\r\n        else\r\n            if (getTypeStr (pointer[path]) != 'number')\r\n                throw new Error ('cannot apply $mul on a non-numeric value');\r\n            else\r\n                pointer[path] *= change;\r\n    },\r\n    '$bit':         function $bit (pointer, path, change) {\r\n        if (getTypeStr (change) != 'object')\r\n            throw new Error ('invalid $bit update');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = 0;\r\n        else if (getTypeStr (pointer[path]) != 'number')\r\n            throw new Error ('cannot apply $bit on a non-numeric value');\r\n\r\n        for (var bitop in change) {\r\n            var delta = change[bitop];\r\n            if (typeof delta != 'number')\r\n                throw new Error ('cannot $bit by a non-numeric value');\r\n            if (bitop == 'and')\r\n                pointer[path] &= delta;\r\n            else if (bitop == 'or')\r\n                pointer[path] |= delta;\r\n            else if (bitop == 'xor')\r\n                pointer[path] ^= delta;\r\n            else\r\n                throw new Error ('unknown bit operation '+bitop);\r\n        }\r\n    },\r\n    '$unset':       function $unset (pointer, path, change) {\r\n        delete pointer[path];\r\n    },\r\n    '$currentDate': function $currentDate (pointer, path, change) {\r\n        pointer[path] = new Date();\r\n    },\r\n    '$rename':      true, // this op is translated to $set/$unset at an earlier stage\r\n    '$isolated':    true  // this op doesn't do anything\r\n};\r\n\r\n\r\nvar arrOps = {\r\n    '$addToSet':    function $addToSet (pointer, path, change) {\r\n        if (\r\n            Object.hasOwnProperty.call (change, '$position')\r\n         || Object.hasOwnProperty.call (change, '$sort')\r\n         || Object.hasOwnProperty.call (change, '$slice')\r\n        )\r\n            throw new Error ('Ordering modifiers are not allowed together with $addToSet');\r\n\r\n        if (!Object.hasOwnProperty.call (pointer, path)) {\r\n            pointer[path] = [ change ];\r\n            return;\r\n        }\r\n\r\n        var arr = pointer[path];\r\n            if (getTypeStr (change) == 'object' && Object.hasOwnProperty.call (change, '$each'))\r\n                for (var i in change.$each) {\r\n                    var candidate = change.$each[i];\r\n                    var write = true;\r\n                    for (var j in arr)\r\n                        if (matchLeaves (arr[j], candidate)) {\r\n                            write = false;\r\n                            break;\r\n                        }\r\n                    if (write)\r\n                        arr.push (change.$each[i]);\r\n                }\r\n            else {\r\n                for (var i in arr)\r\n                    if (matchLeaves (arr[i], change))\r\n                        return;\r\n                arr.push (change);\r\n            }\r\n    },\r\n    '$push':        function $push (pointer, path, change) {\r\n        var changeType = getTypeStr (change);\r\n        var arr = pointer[path];\r\n        if (changeType != 'object')\r\n            arr.push (change);\r\n        else if (Object.hasOwnProperty.call (change, '$each')) {\r\n            var each = change.$each;\r\n            // apply $each, with or without $position\r\n            var position;\r\n            if (Object.hasOwnProperty.call (change, '$position'))\r\n                if (change.$position < 0)\r\n                    throw new Error ('$position does not accept negative numbers');\r\n                else\r\n                    position = change.$position >= arr.length ? undefined : change.$position;\r\n            if (position === undefined)\r\n                for (var i in each)\r\n                    if (moreDollars (each[i]))\r\n                        throw new Error ('invalid property key in complex update');\r\n                    else arr.push (each[i]);\r\n            else\r\n                for (var i in each)\r\n                    if (moreDollars (each[i]))\r\n                        throw new Error ('invalid property key in complex update');\r\n                    else arr.splice (position, 0, each[i]);\r\n\r\n            // apply $sort\r\n            if (Object.hasOwnProperty.call (change, '$sort')) {\r\n                var sspec = change.$sort;\r\n                if (typeof sspec == 'number') {\r\n                    sspec = sspec > 0 ? 1 : -1;\r\n                    // leaf sort\r\n                    arr.sort (Sorting.getLeafsort (sspec));\r\n                } else\r\n                    // document sort\r\n                    arr.sort (Sorting.getDocsort (sspec));\r\n            }\r\n\r\n            // apply $slice\r\n            if (Object.hasOwnProperty.call (change, '$slice'))\r\n                if (change.$slice < 0)\r\n                    pointer[path] = arr.slice (change.$slice);\r\n                else\r\n                    pointer[path] = arr.slice (0, change.$slice);\r\n        } else if (!moreDollars (change))\r\n            arr.push (change);\r\n    },\r\n    '$pop':         function $pop (pointer, path, change) {\r\n        var changeType = getTypeStr (change);\r\n        if (changeType != 'number')\r\n            throw new Error ('$pop requires a number');\r\n\r\n        if (change > 0)\r\n            arr.pop();\r\n        else if (change < 0)\r\n            arr.shift();\r\n    },\r\n    '$pull':        function $pull (pointer, path, change) {\r\n        var arr = pointer[path];\r\n        var changeType = getTypeStr (change);\r\n        if (changeType == 'object') {\r\n            // match with query\r\n            for (var i=0,j=arr.length; i<j; i++)\r\n                if (matchQuery (arr[i], change)) {\r\n                    arr.splice (i, 1);\r\n                    i--; j--;\r\n                }\r\n        } else\r\n            // match with leaf\r\n            for (var i=0,j=arr.length; i<j; i++)\r\n                if (matchLeaves (arr[i], change)) {\r\n                    arr.splice (i, 1);\r\n                    i--; j--;\r\n                }\r\n    },\r\n    '$pullAll':     function $pullAll (pointer, path, change) {\r\n        var arr = pointer[path];\r\n        if (getTypeStr (change) != 'array')\r\n            throw new Error ('$pullAll requires an Array of values/documents to match');\r\n        for (var i in change)\r\n            for (var k=0, l=arr.length; k<l; k++)\r\n                if (matchLeaves (arr[k], change[i])) {\r\n                    arr.splice (k, 1);\r\n                    k--; l--;\r\n                }\r\n    }\r\n};\r\n\r\n\r\nvar ops = {};\r\nfor (var op in fieldOps) ops[op] = fieldOps[op];\r\nfor (var op in arrOps) ops[op] = arrOps[op];\r\n\r\nmodule.exports.ops = ops;\r\nmodule.exports.fieldOps = fieldOps;\r\nmodule.exports.arrOps = arrOps;\r\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n"]}