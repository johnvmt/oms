(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.omsintercept = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function QueueEmitter(){}var EventEmitter=require("wolfy87-eventemitter");QueueEmitter.prototype.__proto__=EventEmitter.prototype,QueueEmitter.prototype.emit=function(){var t=this,e=Array.prototype.slice.call(arguments),o=e.shift(),n=e.pop(),i=t.getListeners(o),u=[];i.forEach(function(t){u.push(t.listener)}),this._callbackQueue(u,e,function(e){i.filter(function(t){return t.once}).forEach(function(e){t.off(o,e.listener)}),"function"==typeof n&&n("undefined"==typeof e?null:e)})},QueueEmitter.prototype._callbackQueue=function(t,e,o){function n(u){i++,"undefined"!=typeof u||"function"!=typeof t[i]?o(u):t[i].apply(this,e.concat([n]))}var i=-1;n()},module.exports=QueueEmitter;
},{"wolfy87-eventemitter":2}],2:[function(require,module,exports){
!function(e){"use strict";function t(){}function n(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}function i(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&i(e.listener)}var s=t.prototype,o=e.EventEmitter;s.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},s.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},s.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},s.addListener=function(e,t){if(!i(t))throw new TypeError("listener must be a function");var r,s=this.getListenersAsObject(e),o="object"==typeof t;for(r in s)s.hasOwnProperty(r)&&n(s[r],t)===-1&&s[r].push(o?t:{listener:t,once:!1});return this},s.on=r("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=r("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,t){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=n(s[i],t),r!==-1&&s[i].splice(r,1));return this},s.off=r("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},s.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},s.removeAllListeners=r("removeEvent"),s.emitEvent=function(e,t){var n,r,i,s,o,u=this.getListenersAsObject(e);for(s in u)if(u.hasOwnProperty(s))for(n=u[s].slice(0),i=0;i<n.length;i++)r=n[i],r.once===!0&&this.removeListener(e,r.listener),o=r.listener.apply(this,t||[]),o===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},s.trigger=r("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},s._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return e.EventEmitter=o,t},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:e.EventEmitter=t}(this||{});
},{}],3:[function(require,module,exports){
function OmsIntercept(t){this.collection=t,this._maxOpId=0,this._replicateCollectionFunctions()}var QueueEmitter=require("queue-emitter");OmsIntercept.prototype.__proto__=QueueEmitter.prototype,OmsIntercept.prototype._replicateCollectionFunctions=function(){var t=this,n=t._objectPublicFunctions(this.collection),o=["isCapped"];n.forEach(function(n){"undefined"==typeof t[n]&&o.indexOf(n)<0&&(t[n]=function(){t._collectionFunction(n,Array.prototype.slice.call(arguments))})})},OmsIntercept.prototype._collectionFunction=function(t,n){function o(o){null!==o?c(o):r.collection[t].apply(r.collection,n.concat([c]))}function c(){l=Array.prototype.slice.call(arguments),r.emit.apply(r,[t].concat(p).concat(l).concat([e]))}function e(t){if("function"==typeof u){var n=Array.prototype.slice.call(arguments);n.shift(),i(n)}}function i(){"function"==typeof u&&u.apply(r,l)}var r=this,p=r._maxOpId,l=void 0;if(r._maxOpId++,Array.isArray(n)&&n.length>0&&"function"==typeof n[n.length-1])var u=n.pop();r.emit.apply(r,["pre-"+t].concat(p).concat(n).concat([o]))},OmsIntercept.prototype._objectPublicFunctions=function(t){function n(t){var n=[];for(var o in t)"function"==typeof t[o]&&n.push(o);return n}return n(t).filter(function(t){return"_"!==t[0]&&"globalFunctions"!==t})},module.exports=function(t){return new OmsIntercept(t)};
},{"queue-emitter":1}]},{},[3])(3)
});


//# sourceMappingURL=omsintercept.js.map